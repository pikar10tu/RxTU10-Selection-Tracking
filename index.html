<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>RxTU10</title>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
<style>
:root{--sci:#2563eb;--care:#10b981;--gold:#f59e0b;--bg:#f0f4f8;--text:#1e293b;--muted:#64748b;--border:#e2e8f0;--ticker:34px;--btm:66px;}
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;font-family:'Kanit',sans-serif;background:var(--bg);color:var(--text);}

/* ‚îÄ‚îÄ TOP BAR ‚îÄ‚îÄ */
/* top-bar removed */
.coin-pill{background:linear-gradient(135deg,#fef3c7,#fde68a);border:1px solid #f59e0b;padding:5px 12px;border-radius:16px;font-size:0.88rem;font-weight:700;color:#92400e;cursor:pointer;display:inline-flex;align-items:center;gap:4px;}
.btn-daily{background:none;border:2px solid var(--border);padding:6px 12px;border-radius:10px;font-size:1rem;cursor:pointer;opacity:.4;transition:.2s;font-family:inherit;}
.btn-daily.ready{opacity:1;border-color:var(--care);animation:pulse 2s ease infinite;}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}
.btn-out{background:none;border:1.5px solid #fca5a5;color:#ef4444;padding:7px 14px;border-radius:9px;font-family:inherit;font-size:0.82rem;cursor:pointer;width:100%;}
.btn-google{background:#fff;border:1.5px solid var(--border);padding:6px 11px;border-radius:9px;font-family:inherit;font-size:0.82rem;cursor:pointer;display:flex;align-items:center;gap:6px;color:var(--text);font-weight:500;transition:.2s;}
.btn-google.big{padding:13px 22px;font-size:0.95rem;width:100%;justify-content:center;}

/* ‚îÄ‚îÄ NEWS TICKER ‚îÄ‚îÄ */
/* ticker now inline in Play tab */
.ticker-label{background:#f59e0b;color:#1e293b;padding:3px 9px;font-weight:800;font-size:0.72rem;white-space:nowrap;border-radius:6px 0 0 6px;}
.ticker-scroll{flex:1;overflow:hidden;position:relative;height:34px;}
.ticker-inner{position:absolute;white-space:nowrap;animation:tickerMove 22s linear infinite;padding:0 12px;line-height:34px;font-size:0.8rem;}
@keyframes tickerMove{0%{transform:translateX(100%)}100%{transform:translateX(-100%)}}
.ticker-inner:hover{animation-play-state:paused;}
.news-banner{background:linear-gradient(135deg,#1e293b,#334155);color:#fde68a;font-weight:600;display:flex;align-items:center;border-radius:12px;overflow:hidden;cursor:pointer;margin-bottom:10px;height:36px;}

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
#main-content{
    position:fixed;
    top:0;left:0;right:0;
    bottom:var(--btm);
    overflow-y:auto;
    -webkit-overflow-scrolling:touch;
    padding:12px 12px 24px;
}

/* ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ */
#bottom-nav{position:fixed;bottom:0;left:0;right:0;height:var(--btm);background:#fff;border-top:1px solid var(--border);display:flex;z-index:200;box-shadow:0 -3px 12px rgba(0,0,0,.07);padding-bottom:env(safe-area-inset-bottom,0px);}
.bn-item{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;cursor:pointer;border:none;background:none;font-family:inherit;color:var(--muted);font-size:0.67rem;font-weight:600;transition:.15s;padding:5px 2px;}
.bn-icon{font-size:1.3rem;transition:.15s;}
.bn-item.active{color:var(--gold);}
.bn-item.active .bn-icon{transform:translateY(-2px);}

/* ‚îÄ‚îÄ COMMON ‚îÄ‚îÄ */
.card{background:#fff;border-radius:16px;padding:14px;box-shadow:0 2px 8px rgba(0,0,0,.05);margin-bottom:10px;}
.sec-head{font-size:0.72rem;font-weight:700;color:var(--muted);letter-spacing:2px;text-transform:uppercase;text-align:center;margin:16px 0 8px;}
.login-card{background:#fff;border-radius:20px;padding:36px 20px;text-align:center;box-shadow:0 4px 16px rgba(0,0,0,.07);}
.track-badge{padding:3px 8px;border-radius:5px;color:#fff;font-size:0.58rem;font-weight:700;text-transform:uppercase;}
.guest-badge{background:#64748b;}
.track-badge.sm{font-size:0.54rem;padding:2px 6px;}

/* ‚îÄ‚îÄ HOME ‚îÄ‚îÄ */
.profile-card{display:flex;align-items:center;gap:12px;background:#fff;border-radius:16px;padding:14px;box-shadow:0 4px 14px rgba(0,0,0,.08);margin-bottom:10px;border:2px solid var(--gold);}
.pc-img-wrap{position:relative;flex-shrink:0;}
.pc-img{width:70px;height:70px;border-radius:50%;object-fit:cover;border:3px solid #fff;box-shadow:0 3px 10px rgba(0,0,0,.12);}
.pc-cam{position:absolute;bottom:-2px;right:-2px;background:#fff;border:2px solid var(--border);border-radius:50%;width:22px;height:22px;font-size:0.65rem;cursor:pointer;display:flex;align-items:center;justify-content:center;}
.pc-nick{font-size:1.1rem;font-weight:800;} .pc-real{font-size:0.8rem;color:var(--muted);} .pc-id{font-size:0.68rem;color:var(--muted);font-family:'Space Mono',monospace;}
.stats-row{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:10px;}
.stat-box{background:#fff;border-radius:12px;padding:10px 5px;text-align:center;box-shadow:0 2px 6px rgba(0,0,0,.04);}
.sb-icon{font-size:1.1rem;margin-bottom:1px;} .stat-box b{display:block;font-size:0.9rem;font-weight:700;} .stat-box small{font-size:0.64rem;color:var(--muted);}
.unlinked-card{display:flex;align-items:center;gap:10px;background:#fff;border-radius:16px;padding:12px;box-shadow:0 2px 8px rgba(0,0,0,.05);margin-bottom:10px;border:2px dashed var(--border);}
.ul-left{display:flex;align-items:center;gap:9px;flex:1;}
.ul-img{width:38px;height:38px;border-radius:50%;object-fit:cover;border:2px solid var(--border);}
.btn-link{background:linear-gradient(135deg,var(--sci),#1d4ed8);color:#fff;border:none;padding:7px 12px;border-radius:9px;font-family:inherit;font-size:0.78rem;font-weight:600;cursor:pointer;white-space:nowrap;}

/* Inventory */
.inv-empty{text-align:center;color:var(--muted);font-size:0.82rem;padding:16px;}
.inv-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(72px,1fr));gap:7px;}
.inv-item{background:var(--rb,#f8fafc);border:2px solid transparent;border-radius:11px;padding:8px 4px;text-align:center;cursor:pointer;transition:.2s;position:relative;}
.inv-item:hover{transform:translateY(-2px);border-color:var(--rc);}
.inv-item.on{border-color:var(--rc);box-shadow:0 0 10px color-mix(in srgb,var(--rc) 20%,transparent);}
.inv-em{font-size:1.6rem;} .inv-nm{font-size:0.62rem;font-weight:600;margin-top:2px;}
.inv-on{position:absolute;top:-5px;right:-5px;background:var(--rc);color:#fff;font-size:0.46rem;font-weight:700;padding:2px 4px;border-radius:4px;}

/* ‚îÄ‚îÄ MEMBERS ‚îÄ‚îÄ */
.filter-row{display:flex;gap:6px;margin-bottom:8px;}
.fbtn{flex:1;padding:7px 3px;border-radius:10px;border:2px solid var(--border);background:#fff;font-family:inherit;font-size:0.76rem;font-weight:600;cursor:pointer;color:var(--muted);transition:.2s;}
.fbtn.fa{border-color:var(--gold);background:#fffbeb;color:#92400e;}
.fbtn.fs{border-color:var(--sci);background:#eff6ff;color:var(--sci);}
.fbtn.fc{border-color:var(--care);background:#ecfdf5;color:var(--care);}
.search-box{margin-bottom:8px;}
.srch-inp{width:100%;padding:10px 13px;border:2px solid #fff;border-radius:12px;font-family:inherit;font-size:0.9rem;background:#fff;box-shadow:0 3px 10px rgba(0,0,0,.07);outline:none;transition:.2s;}
.srch-inp:focus{border-color:var(--gold);}
.mgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(105px,1fr));gap:8px;}
.mcard{background:#fff;border-radius:13px;padding:11px 6px;cursor:pointer;text-align:center;border:1.5px solid var(--border);transition:.2s;display:flex;flex-direction:column;align-items:center;gap:4px;}
.mcard:hover{transform:translateY(-2px);box-shadow:0 5px 12px rgba(0,0,0,.07);}
.mc-img{width:56px;height:56px;border-radius:50%;object-fit:cover;border:3px solid #fff;box-shadow:0 2px 7px rgba(0,0,0,.1);}
.mc-emoji-fallback{width:56px;height:56px;border-radius:50%;background:var(--bg);border:3px solid #fff;box-shadow:0 2px 7px rgba(0,0,0,.1);font-size:1.8rem;align-items:center;justify-content:center;}
.mc-nick{font-weight:600;font-size:0.82rem;} .mc-id{font-size:0.62rem;color:var(--muted);}
.prog-bar{height:16px;background:var(--border);border-radius:50px;overflow:hidden;display:flex;margin-bottom:4px;}
.pb-sci{background:var(--sci);height:100%;} .pb-care{background:var(--care);height:100%;}
.prog-lbls{display:flex;justify-content:space-between;font-size:0.76rem;font-weight:600;}

/* ‚îÄ‚îÄ PLAY ‚îÄ‚îÄ */
.q-nick{font-size:1.35rem;font-weight:800;color:var(--gold);text-align:center;margin-bottom:12px;}
.q-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.q-btn{background:#f8fafc;border:2px solid var(--border);padding:11px 6px;border-radius:11px;font-family:inherit;font-size:0.82rem;cursor:pointer;transition:.15s;color:var(--text);line-height:1.3;}
.q-btn:hover:not(:disabled){background:#f1f5f9;}
.q-btn.correct{background:#dcfce7;border-color:#10b981;color:#065f46;}
.q-btn.wrong{background:#fee2e2;border-color:#ef4444;color:#7f1d1d;}
.flashcard{background:#f8fafc;border-radius:13px;padding:22px;min-height:90px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;border:2px dashed var(--border);gap:5px;text-align:center;}
.coming-soon{background:linear-gradient(135deg,#1e293b,#334155);border-radius:16px;padding:28px;text-align:center;color:#fff;margin-bottom:10px;}

/* ‚îÄ‚îÄ SHOP ‚îÄ‚îÄ */
.egg-wobble{font-size:3.8rem;animation:wobble 2.5s ease infinite;display:block;}
@keyframes wobble{0%,100%{transform:rotate(-6deg)}50%{transform:rotate(6deg)}}
.rates-wrap{display:flex;flex-wrap:wrap;gap:5px;justify-content:center;}
.rate-chip{padding:4px 10px;border-radius:16px;font-size:0.72rem;font-weight:700;}
.egg-bag-item{display:flex;align-items:center;gap:10px;padding:11px;border-radius:12px;background:var(--rb,#f8fafc);border:1.5px solid var(--rc,var(--border));margin-bottom:8px;}
.hatch-bar{height:5px;background:var(--border);border-radius:8px;overflow:hidden;margin:4px 0 2px;}
.hatch-fill{height:100%;border-radius:8px;transition:width .3s;}

/* ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ */
.modal-ov{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:500;align-items:center;justify-content:center;padding:14px;backdrop-filter:blur(4px);}
.modal-ov.active{display:flex;}
.modal-box{background:#fff;border-radius:20px;padding:24px 18px;max-width:340px;width:100%;animation:popIn .35s cubic-bezier(.34,1.56,.64,1);position:relative;max-height:88vh;overflow-y:auto;}
@keyframes popIn{from{transform:scale(.5);opacity:0}to{transform:scale(1);opacity:1}}
.mclose{position:absolute;top:10px;right:10px;background:var(--border);border:none;width:26px;height:26px;border-radius:50%;cursor:pointer;font-size:0.85rem;display:flex;align-items:center;justify-content:center;}
.pm-img{width:80px;height:80px;border-radius:50%;object-fit:cover;border:3px solid #fff;box-shadow:0 3px 12px rgba(0,0,0,.12);margin-bottom:9px;}
.pm-nick{font-size:1.25rem;font-weight:700;} .pm-real{color:var(--muted);font-size:0.88rem;} .pm-id{font-size:0.74rem;color:var(--muted);font-family:'Space Mono',monospace;margin:3px 0;}
.pm-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:7px;margin-bottom:9px;}
.pm-stat{background:var(--bg);border-radius:9px;padding:7px 3px;text-align:center;display:flex;flex-direction:column;align-items:center;}
.pm-stat span{font-size:1rem;} .pm-stat b{font-size:0.85rem;font-weight:700;} .pm-stat small{font-size:0.62rem;color:var(--muted);}
.pm-pet-row{display:flex;align-items:center;gap:9px;background:var(--bg);border-radius:11px;padding:9px;margin-top:4px;}
.link-irow{display:flex;gap:6px;margin:10px 0 3px;}
.link-inp{flex:1;padding:10px 12px;border:2px solid var(--border);border-radius:10px;font-family:inherit;font-size:0.92rem;outline:none;transition:.2s;}
.link-inp:focus{border-color:var(--sci);}
.link-prev{background:var(--bg);border-radius:12px;padding:12px;margin:6px 0;display:none;}
.gacha-inner{display:flex;flex-direction:column;align-items:center;gap:8px;text-align:center;}
.gr-badge{padding:3px 12px;border-radius:16px;color:#fff;font-size:0.72rem;font-weight:800;letter-spacing:2px;}
.gr-emoji{font-size:4.5rem;animation:gbounce .6s ease;filter:drop-shadow(0 0 16px var(--glow,#f59e0b));}
@keyframes gbounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-14px)}}
.gr-name{font-size:1.3rem;font-weight:800;} .gr-desc{font-size:0.82rem;color:var(--muted);}
.gr-btns{display:flex;gap:8px;margin-top:6px;}
.slide-panel{position:fixed;bottom:0;left:0;right:0;background:#fff;border-radius:20px 20px 0 0;padding:18px 14px;box-shadow:0 -5px 24px rgba(0,0,0,.1);z-index:400;transform:translateY(100%);transition:transform .35s cubic-bezier(.34,1.56,.64,1);max-height:65vh;overflow-y:auto;}
.slide-panel.active{transform:translateY(0);}
.trade-item{display:flex;align-items:center;gap:8px;padding:8px;border-radius:9px;border:2px solid var(--border);cursor:pointer;margin-bottom:6px;transition:.15s;}
.trade-item.sel{border-color:var(--sci);background:#eff6ff;}
.trade-inp{width:100%;padding:9px 12px;border:2px solid var(--border);border-radius:10px;font-family:inherit;font-size:0.86rem;outline:none;margin:8px 0;}
.trade-inp:focus{border-color:var(--sci);}

/* Feed/News modal */
.feed-item{padding:10px 0;border-bottom:1px solid var(--border);display:flex;gap:10px;align-items:flex-start;}
.feed-item:last-child{border-bottom:none;}
.feed-icon{font-size:1.4rem;flex-shrink:0;}
.feed-time{font-size:0.66rem;color:var(--muted);margin-top:2px;}
.feed-msg{font-size:0.84rem;}

/* Megaphone modal */
.mega-inp{width:100%;padding:10px 12px;border:2px solid var(--border);border-radius:10px;font-family:inherit;font-size:0.9rem;outline:none;margin:10px 0;resize:none;}
.mega-inp:focus{border-color:var(--gold);}

/* Buttons */
.btn-gold{background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff;border:none;padding:9px 16px;border-radius:10px;font-family:inherit;font-size:0.9rem;font-weight:700;cursor:pointer;transition:.2s;}
.btn-gold:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 4px 12px rgba(245,158,11,.4);}
.btn-gold:disabled{opacity:.5;cursor:not-allowed;}
.btn-gold.full{width:100%;}
.btn-gold.sm{padding:6px 11px;font-size:0.78rem;}
.btn-gray{background:var(--border);color:var(--muted);border:none;padding:8px 14px;border-radius:10px;font-family:inherit;font-size:0.86rem;cursor:pointer;}
.btn-gray.sm{padding:5px 10px;font-size:0.74rem;}
.btn-gray.full{width:100%;}

/* Name effects */
.gold-name{background:linear-gradient(90deg,#f59e0b,#fbbf24,#f59e0b);background-size:200% auto;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:sh 2s linear infinite;display:inline-block;}
.rainbow-name{background:linear-gradient(90deg,#f59e0b,#ef4444,#a855f7,#3b82f6,#10b981,#f59e0b);background-size:200% auto;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:sh 1.5s linear infinite;display:inline-block;}
@keyframes sh{to{background-position:200% center}}

/* Egg bag extras */

#toast{position:fixed;bottom:calc(var(--btm)+16px);left:50%;transform:translateX(-50%);color:#fff;font-size:0.84rem;font-weight:500;z-index:1000;transition:opacity .2s;white-space:nowrap;pointer-events:none;opacity:0;}
#toast.show{opacity:1;background:#1e293b;padding:9px 15px;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,.2);}
#toast.show.success{background:#065f46;} #toast.show.error{background:#7f1d1d;} #toast.show.info{background:#1e40af;}
@media(max-width:360px){.mgrid{grid-template-columns:repeat(auto-fill,minmax(92px,1fr))}}
</style>
</head>
<body>

<div id="news-ticker" style="display:none"><div id="ticker-text"></div></div>

<div id="main-content">
    <div style="text-align:center;padding:60px 20px;color:var(--muted)">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
</div>

<nav id="bottom-nav">
    <button class="bn-item active" data-tab="home" onclick="switchTab('home')"><span class="bn-icon">üè†</span>Home</button>
    <button class="bn-item" data-tab="members" onclick="switchTab('members')"><span class="bn-icon">üë•</span>Members</button>
    <button class="bn-item" data-tab="play" onclick="switchTab('play')"><span class="bn-icon">üéÆ</span>Play</button>
    <button class="bn-item" data-tab="shop" onclick="switchTab('shop')"><span class="bn-icon">üõí</span>Shop</button>
</nav>

<!-- PROFILE MODAL -->
<div class="modal-ov" id="profile-modal" onclick="if(event.target===this)closePM()">
    <div class="modal-box" style="text-align:center">
        <button class="mclose" onclick="closePM()">‚úï</button>
        <div id="pm-content"></div>
    </div>
</div>

<!-- LINK MODAL -->
<div class="modal-ov" id="link-modal" onclick="if(event.target===this)closeLinkModal()">
    <div class="modal-box">
        <button class="mclose" onclick="closeLinkModal()">‚úï</button>
        <!-- Section A: student ID -->
        <div id="link-section-student">
            <div style="font-size:1.2rem;font-weight:800;margin-bottom:3px">üîó ‡∏ú‡∏π‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</div>
            <div style="font-size:0.8rem;color:var(--muted);margin-bottom:8px">‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ 10 ‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</div>
            <div class="link-irow">
                <input type="text" class="link-inp" id="link-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô 6518610016" maxlength="10"
                       oninput="this.value=this.value.replace(/[^0-9]/g,'')"
                       onkeyup="if(this.value.length===10)previewLink()">
                <button class="btn-gold" onclick="previewLink()">‡πÄ‡∏ä‡πá‡∏Ñ</button>
            </div>
            <div id="link-error" style="color:#ef4444;font-size:0.78rem;min-height:15px;margin-bottom:1px"></div>
            <div class="link-prev" id="link-preview">
                <div style="display:flex;align-items:center;gap:9px">
                    <div style="font-size:1.8rem">üë§</div>
                    <div>
                        <div style="font-weight:700;font-size:1rem" id="lp-nick"></div>
                        <div style="font-size:0.8rem;color:var(--muted)" id="lp-name"></div>
                        <span class="track-badge" id="lp-track" style="margin-top:3px;display:inline-block"></span>
                    </div>
                </div>
                <div style="font-size:0.76rem;color:var(--muted);margin-top:7px">‡πÉ‡∏ä‡πà‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏´‡∏°?</div>
            </div>
            <div style="display:flex;gap:7px;margin-top:10px">
                <button class="btn-gold" style="flex:1" onclick="confirmLink()">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                <button class="btn-gray" style="flex:1" onclick="closeLinkModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
            <div style="text-align:center;margin-top:12px;padding-top:10px;border-top:1px solid var(--border)">
                <button onclick="showGuestSection()" style="background:none;border:none;color:var(--muted);font-size:0.78rem;cursor:pointer;font-family:inherit;text-decoration:underline">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ / ‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ö‡∏ö Guest üëã</button>
            </div>
        </div>
        <!-- Section B: guest -->
        <div id="link-section-guest" style="display:none">
            <div style="font-size:1.2rem;font-weight:800;margin-bottom:3px">üëã ‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ö‡∏ö Guest</div>
            <div style="font-size:0.8rem;color:var(--muted);margin-bottom:10px">‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ)</div>
            <input type="text" class="link-inp" id="guest-name-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏´‡πá‡∏ô..." maxlength="20" style="width:100%;margin-bottom:4px">
            <div id="guest-error" style="color:#ef4444;font-size:0.78rem;min-height:15px;margin-bottom:1px"></div>
            <div style="display:flex;gap:7px;margin-top:8px">
                <button class="btn-gold" style="flex:1" onclick="confirmGuest()">‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡∏¢</button>
                <button class="btn-gray" onclick="showStudentSection()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
            </div>
        </div>
    </div>
</div>

<!-- GACHA MODAL -->
<div class="modal-ov" id="gacha-modal" onclick="if(event.target===this)closeGacha()">
    <div class="modal-box"><div id="gacha-result"></div></div>
</div>

<!-- PET INFO MODAL -->
<div class="modal-ov" id="petinfo-modal" onclick="if(event.target===this)closePetInfo()">
    <div class="modal-box">
        <button class="mclose" onclick="closePetInfo()">‚úï</button>
        <div id="petinfo-content"></div>
        <div style="display:flex;gap:7px;margin-top:14px" id="petinfo-actions"></div>
    </div>
</div>

<!-- FEED MODAL -->
<div class="modal-ov" id="feed-modal" onclick="if(event.target===this)closeFeed()">
    <div class="modal-box">
        <button class="mclose" onclick="closeFeed()">‚úï</button>
        <div style="font-size:1.1rem;font-weight:800;margin-bottom:12px">üì¢ ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏Ç‡πà‡∏≤‡∏ß</div>
        <div id="feed-list"><div style="color:var(--muted);text-align:center;padding:20px">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div></div>
    </div>
</div>

<!-- MEGAPHONE MODAL -->
<div class="modal-ov" id="mega-modal" onclick="if(event.target===this)closeMega()">
    <div class="modal-box">
        <button class="mclose" onclick="closeMega()">‚úï</button>
        <div style="font-size:1.1rem;font-weight:800;margin-bottom:4px">üì£ ‡πÉ‡∏ä‡πâ‡πÇ‡∏ó‡∏£‡πÇ‡∏Ç‡πà‡∏á</div>
        <div style="font-size:0.8rem;color:var(--muted);margin-bottom:2px">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏∂‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô ‚Äî ‡πÉ‡∏ä‡πâ 25ü™ô</div>
        <textarea class="mega-inp" id="mega-text" rows="3" maxlength="80" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏ö‡∏≠‡∏Å‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 80 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)..."></textarea>
        <div style="font-size:0.72rem;color:var(--muted);margin-bottom:10px">‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: <b id="mega-coins">0</b> ü™ô</div>
        <div style="display:flex;gap:7px">
            <button class="btn-gold" style="flex:1" onclick="sendMegaphone()">üì£ ‡∏™‡πà‡∏á (25ü™ô)</button>
            <button class="btn-gray" style="flex:1" onclick="closeMega()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
    </div>
</div>

<!-- TRADE PANEL -->
<div class="slide-panel" id="trade-panel">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <span style="font-weight:700">üîÑ Trade ‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</span>
        <button class="mclose" style="position:static" onclick="closeTrade()">‚úï</button>
    </div>
    <p style="font-size:0.8rem;color:var(--muted);margin-bottom:8px">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏™‡πà‡∏á:</p>
    <div id="trade-pets"></div>
    <input type="email" class="trade-inp" id="trade-email" placeholder="Email ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ">
    <button class="btn-gold full" onclick="sendTrade()">‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô ‚úâÔ∏è</button>
</div>

<div id="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged }
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot,
         collection, getDocs, increment, serverTimestamp, arrayUnion, addDoc, orderBy, query, limit }
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyAlmHZZ3JixrQlH7PyMa_QqQuDPEN4RJBE",
    authDomain: "rxtu10dashboard.firebaseapp.com",
    projectId: "rxtu10dashboard",
    storageBucket: "rxtu10dashboard.firebasestorage.app",
    messagingSenderId: "485847555600",
    appId: "1:485847555600:web:1ee57ea6044c687b10b495"
};

const app  = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db   = getFirestore(app);
const provider = new GoogleAuthProvider();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CONSTANTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const RARITY = {
    common:    { color:"#64748b", bg:"#f1f5f9", label:"COMMON",    glow:"#94a3b8" },
    rare:      { color:"#3b82f6", bg:"#eff6ff", label:"RARE",      glow:"#60a5fa" },
    epic:      { color:"#a855f7", bg:"#faf5ff", label:"EPIC",      glow:"#c084fc" },
    legendary: { color:"#f59e0b", bg:"#fffbeb", label:"LEGENDARY", glow:"#fbbf24" },
};
const PETS = [
    { id:"cat",       emoji:"üê±", name:"‡∏ô‡πâ‡∏≠‡∏á‡πÅ‡∏°‡∏ß",     rarity:"common",    effect:"none",      desc:"‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ã‡∏µ‡πâ cute ‡πÑ‡∏°‡πà‡∏°‡∏µ effect ‡∏û‡∏¥‡πÄ‡∏®‡∏©",              rate:0.20, hatchMins:5   },
    { id:"rabbit",    emoji:"üê∞", name:"‡∏Å‡∏£‡∏∞‡∏ï‡πà‡∏≤‡∏¢",    rarity:"common",    effect:"none",      desc:"‡∏Ç‡∏ô‡∏ü‡∏π ‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡∏î‡∏µ ‡πÑ‡∏°‡πà‡∏°‡∏µ effect ‡∏û‡∏¥‡πÄ‡∏®‡∏©",               rate:0.15, hatchMins:5   },
    { id:"hamster",   emoji:"üêπ", name:"‡πÅ‡∏Æ‡∏°‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå",  rarity:"common",    effect:"none",      desc:"‡∏ß‡∏¥‡πà‡∏á‡∏•‡πâ‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô ‡πÑ‡∏°‡πà‡∏°‡∏µ effect ‡∏û‡∏¥‡πÄ‡∏®‡∏©",             rate:0.15, hatchMins:5   },
    { id:"fox",       emoji:"ü¶ä", name:"‡∏à‡∏¥‡πâ‡∏á‡∏à‡∏≠‡∏Å",    rarity:"rare",      effect:"coin+10",   desc:"+10% ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏à‡∏≤‡∏Å‡πÄ‡∏Å‡∏°‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á",                     rate:0.12, hatchMins:60  },
    { id:"owl",       emoji:"ü¶â", name:"‡∏ô‡∏Å‡∏Æ‡∏π‡∏Å",      rarity:"rare",      effect:"coin+15",   desc:"+15% ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏à‡∏≤‡∏Å‡πÄ‡∏Å‡∏°‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á",                     rate:0.10, hatchMins:60  },
    { id:"panda",     emoji:"üêº", name:"‡πÅ‡∏û‡∏ô‡∏î‡πâ‡∏≤",     rarity:"rare",      effect:"score+5",   desc:"+5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡πÉ‡∏ô Quiz",                   rate:0.08, hatchMins:60  },
    { id:"dragon",    emoji:"üê≤", name:"‡∏°‡∏±‡∏á‡∏Å‡∏£‡∏ô‡πâ‡∏≠‡∏¢",  rarity:"epic",      effect:"coinx2",    desc:"‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç x2 ‡∏à‡∏≤‡∏Å‡πÄ‡∏Å‡∏°‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó",                    rate:0.06, hatchMins:180 },
    { id:"unicorn",   emoji:"ü¶Ñ", name:"‡∏¢‡∏π‡∏ô‡∏¥‡∏Ñ‡∏≠‡∏£‡πå‡∏ô",  rarity:"epic",      effect:"scorex2",   desc:"‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô Quiz x2 ‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠",                         rate:0.05, hatchMins:180 },
    { id:"phoenix",   emoji:"ü¶Ö", name:"‡∏ü‡∏µ‡∏ô‡∏¥‡∏Å‡∏ã‡πå",   rarity:"epic",      effect:"daily50",   desc:"+50 ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç daily ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô",             rate:0.04, hatchMins:180 },
    { id:"kirin",     emoji:"ü¶Å", name:"‡πÑ‡∏Ñ‡∏£‡∏¥‡∏ô",      rarity:"legendary", effect:"gold_name", desc:"‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡πÅ‡∏™‡∏á‡∏™‡∏µ‡∏ó‡∏≠‡∏á ‚ú®",                          rate:0.02, hatchMins:1440},
    { id:"bahamut",   emoji:"üêâ", name:"‡∏û‡∏≤‡∏Æ‡∏≤‡∏°‡∏∏‡∏ó",    rarity:"legendary", effect:"all",       desc:"‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç x3 + ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô x2 + ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏µ‡∏£‡∏∏‡πâ‡∏á",           rate:0.02, hatchMins:1440},
    { id:"celestial", emoji:"üåü", name:"‡πÄ‡∏ã‡πÄ‡∏•‡∏™‡πÄ‡∏ä‡∏µ‡∏¢‡∏•", rarity:"legendary", effect:"rainbow",   desc:"‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∏‡πâ‡∏á + daily 100 ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥",         rate:0.01, hatchMins:1440},
];
const HATCH_LABELS = { common:"5 ‡∏ô‡∏≤‡∏ó‡∏µ", rare:"1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á", epic:"3 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á", legendary:"24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á" };
const EGG_COST = 100, MEGA_COST = 25;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STUDENT DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const R_SCI=["‡∏Å‡∏¥‡πâ‡∏ü‡∏ó‡πå üéÅ (6418610082)","‡πÇ‡∏ö üéÄ (6418610140)","‡∏≠‡∏¥‡∏Å‡∏Ñ‡∏¥‡∏ß üë¶ (6418610264)","‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ ‚õ∞Ô∏è (6418610280)","‡∏Ç‡∏¥‡∏° üéº (6518540015)","‡∏°‡∏≤‡∏¢‡∏î‡πå üíñ (6518610016)","‡∏ï‡∏¥‡∏ô üíé (6518610024)","‡∏≠‡πâ‡∏ô üêøÔ∏è (6518610073)","‡πÄ‡∏≠‡πá‡∏°‡∏°‡∏µ‡πà üå∏ (6518610099)","‡πÇ‡∏ü‡∏Å‡∏±‡∏™ üîç (6518610123)","‡∏•‡∏¥‡πâ‡∏á üîó (6518610164)","‡∏ï‡∏¥‡∏ì‡∏ì‡πå ‚ú® (6518610172)","‡πÄ‡∏û‡πà‡∏¢‡πÄ‡∏û‡πà‡∏¢ üèÆ (6518610180)","‡∏õ‡πà‡∏≤‡∏ô üåø (6518610198)","‡πÄ‡∏≠‡πÄ‡∏ä‡∏µ‡∏¢ üåè (6518610214)","‡πÅ‡∏û‡∏£ üëó (6518610222)","‡∏Å‡∏≤‡∏ü‡∏¥‡∏ß üê± (6518610297)","‡πÅ‡∏ï‡∏á‡πÇ‡∏° üçâ (6518610347)","‡∏™‡πâ‡∏°‡πÇ‡∏≠ üçä (6518610420)","‡∏≠‡∏∏‡πâ‡∏° ü§ó (6518610446)","‡∏ó‡∏¥‡∏ß üå≤ (6518610479)","‡πÅ‡∏û‡∏ô üêº (6518610503)","‡∏õ‡∏±‡πâ‡∏ô üè∫ (6518610545)","‡πÅ‡∏Å‡πä‡∏õ üß¢ (6518610560)","‡πÅ‡∏¢‡∏° üçì (6518610578)","‡πÅ‡∏û‡∏£‡πÑ‡∏´‡∏° üßµ (6518610586)","‡πÑ‡∏≠‡∏à‡∏±‡∏á üç¶ (6518610610)","‡πÄ‡∏û‡πâ‡∏ô‡∏ó‡πå üé® (6518670010)","‡∏™‡∏∏‡πà‡∏ô üß∂ (6518670069)","‡∏ó‡∏∞‡πÄ‡∏• üåä (6518670077)","‡∏ï‡∏±‡πâ‡∏ß üéüÔ∏è (6518670093)","‡πÅ‡∏û‡∏£‡∏ß‡∏≤ üíé (6518670101)","‡∏ã‡∏≤‡πÄ‡∏ô‡∏µ‡∏¢‡∏£‡πå üéê (6518670119)","‡πÄ‡∏õ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå üå∂Ô∏è (6518670150)","‡∏ß‡πà‡∏≤‡∏ô‡∏ß‡πà‡∏≤‡∏ô üçÉ (6518670176)","‡∏ü‡πâ‡∏≤‡πÉ‡∏™ ‚òÄÔ∏è (6518670192)","‡πÄ‡∏Ç‡∏ï üèÅ (6518670200)","‡πÄ‡∏ö‡πÄ‡∏ö‡πâ üß∏ (6518670226)","‡πÄ‡∏ä‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà üçí (6518670267)"];
const R_CARE=["‡πÄ‡∏°‡∏¢‡πå üåô (6418610157)","‡πÄ‡∏î‡∏µ‡∏¢‡∏£ ü¶å (6418670110)","‡∏ö‡∏±‡∏ß ü™∑ (6518610032)","‡∏õ‡∏≤‡∏•‡πå‡∏°‡∏°‡∏µ‡πà üå¥ (6518610040)","‡∏≠‡∏∏‡πã‡∏á‡∏≠‡∏¥‡πã‡∏á ü¶≠ (6518610057)","‡πÄ‡∏û‡∏µ‡∏¢‡∏ß ü´ß (6518610065)","‡πÉ‡∏ö‡∏ö‡∏±‡∏ß üçÉ (6518610081)","‡∏ö‡∏•‡∏π üíô (6518610107)","‡∏ï‡πâ‡∏ô‡∏ô‡πâ‡∏≥ üå± (6518610115)","‡πÅ‡∏ã‡∏ô‡∏ô‡∏µ‡πà ‚òÄÔ∏è (6518610131)","‡∏Å‡∏±‡∏™ ‚õΩ (6518610149)","‡∏ô‡∏¥‡∏ô‡∏à‡∏µ‡πâ ü•∑ (6518610206)","‡∏ô‡∏ô‡∏ó‡πå üï∂Ô∏è (6518610230)","‡∏°‡∏¥‡∏ô‡∏ó‡πå üåø (6518610248)","‡πÅ‡∏õ‡πâ‡∏á üçû (6518610255)","‡∏ï‡∏µ‡∏ï‡∏µ‡πâ üé∏ (6518610263)","‡πÅ‡∏û‡∏° üëí (6518610271)","‡∏≠‡∏∞‡∏ï‡∏≠‡∏° ‚öõÔ∏è (6518610305)","‡∏ô‡∏≤‡∏¢ üëî (6518610313)","‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô üìñ (6518610321)","‡∏ô‡∏±‡∏ã üå† (6518610354)","‡πÅ‡∏û‡∏ô‡∏î‡πâ‡∏≤ üêº (6518610362)","‡∏õ‡∏¥‡πä‡∏Å üé∏ (6518610388)","‡∏à‡∏≠‡∏¢ üòä (6518610396)","‡∏°‡∏≤‡∏¢‡∏î‡πå ‚ú® (6518610404)","‡πÇ‡∏î‡∏ô‡∏±‡∏ó üç© (6518610453)","‡∏ö‡∏∏‡πä‡∏Ñ üìö (6518610461)","‡∏õ‡∏≠‡∏ô‡∏î‡πå üí∑ (6518610495)","‡πÄ‡∏ö‡∏Ñ ü•ì (6518610511)","‡∏ï‡πâ‡∏ô‡∏Å‡∏•‡πâ‡∏≤ ü™¥ (6518610537)","‡∏°‡∏¥‡πâ‡∏ô‡∏ó‡πå üå± (6518610552)","‡∏ï‡πâ‡∏ô‡∏ô‡πâ‡∏≥ üíß (6518610602)","‡πÅ‡∏û‡∏£‡∏ó‡∏≠‡∏á ‚ú® (6518660011)","‡πÅ‡∏Å‡πâ‡∏° üòä (6518660029)","‡πÅ‡∏™‡∏ô‡∏î‡∏µ üòá (6518670028)","‡∏≠‡∏∏‡πä‡∏Å‡∏≠‡∏¥‡πä‡∏Å üê£ (6518670044)","‡∏ï‡πâ‡πâ‡∏ô‡∏ô‡πâ‡∏≥ üåä (6518670085)","‡πÄ‡∏à üÉè (6518670135)","‡πÄ‡∏õ‡∏°‡∏µ‡πà üç≠ (6518670143)","‡∏ó‡πâ‡∏≠‡∏á‡∏ü‡πâ‡∏≤ ‚òÅÔ∏è (6518670184)","‡∏û‡∏µ‡∏ä üçë (6518670218)","‡∏™‡∏°‡∏≤‡∏¢‡∏î‡πå üòÅ (6518670242)","‡πÅ‡∏û‡∏£ üå∏ (6518670259)","‡∏ï‡∏∞‡∏ß‡∏±‡∏ô üåª (6518670283)"];
const RN="‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ä‡∏ç‡∏≤‡∏ô‡∏¥‡∏® ‡∏ä‡∏≤‡∏¢‡πÄ‡∏°‡∏Ü‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ì‡∏±‡∏ä‡∏ä‡∏≤ ‡∏®‡∏£‡∏µ‡∏ó‡∏≠‡∏á‡∏™‡∏∏‡∏Ç‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ì‡∏±‡∏è‡∏ê‡∏ì‡∏¥‡∏ä‡∏≤ ‡∏ï‡∏£‡∏≤‡∏´‡∏¢‡∏Å‡∏ô‡∏≤‡∏¢‡∏õ‡∏ß‡∏£‡∏¥‡∏® ‡∏ä‡∏π‡∏ä‡∏°‡∏ä‡∏∑‡πà‡∏ô‡∏ô‡∏≤‡∏¢‡∏û‡∏®‡∏ß‡∏±‡∏ï ‡∏û‡∏∏‡∏ó‡∏ò‡∏¥‡∏ä‡∏ô‡∏°‡πå‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ì‡∏±‡∏é‡∏ê‡∏£‡∏¥‡∏ì‡∏µ‡∏¢‡πå ‡πÄ‡∏ó‡∏∑‡∏≠‡∏Å‡∏ó‡πâ‡∏≤‡∏ß‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏´‡∏£‡∏£‡∏©‡∏ò‡∏£ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏†‡∏±‡∏Å‡∏î‡∏µ‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏Å‡∏ä‡∏Å‡∏£ ‡∏ó‡∏£‡∏á‡πÄ‡∏ï‡∏ä‡∏∞‡πÄ‡∏•‡∏¥‡∏®‡∏ô‡∏≤‡∏¢‡∏Å‡∏é‡∏õ‡∏¥‡∏¢‡∏£‡∏≤‡∏ä ‡∏ä‡∏ô‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏Å‡∏°‡∏•‡∏û‡∏£ ‡∏ß‡πà‡∏≠‡∏á‡πÑ‡∏ß‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏Å‡∏§‡∏ï‡∏¥‡∏¢‡∏≤‡∏û‡∏£ ‡∏Ñ‡∏≥‡∏®‡∏£‡∏µ‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏Å‡∏≠‡πÅ‡∏Å‡πâ‡∏ß ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏®‡∏π‡∏£‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏Å‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏±‡∏è‡∏ê‡πå ‡∏•‡∏≤‡∏†‡∏ó‡∏£‡∏á‡∏™‡∏∏‡∏Ç‡∏ô‡∏≤‡∏¢‡πÄ‡∏Å‡∏ï‡∏∏‡πÇ‡∏û‡∏ò‡∏¥‡πå ‡πÉ‡∏à‡∏™‡∏á‡∏Ü‡πå‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡πÅ‡∏Å‡πâ‡∏ß‡∏ö‡∏∏‡∏©‡∏£‡∏≤‡∏†‡∏£‡∏ì‡πå ‡πÄ‡∏•‡∏≤‡∏´‡∏Å‡∏±‡∏¢‡∏Å‡∏∏‡∏•‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏á‡∏≤‡∏°‡∏ß‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå ‡∏Å‡∏¥‡∏ï‡∏ï‡∏¥‡∏à‡∏¥‡∏ï‡∏ï‡πå‡∏ô‡∏≤‡∏¢‡∏à‡∏¥‡∏£‡∏ß‡∏±‡∏í‡∏ô‡πå ‡∏£‡∏±‡∏Å‡∏©‡πå‡∏ß‡∏¥‡πÄ‡∏ä‡∏µ‡∏¢‡∏£‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ä‡∏ô‡∏±‡∏ç‡∏ò‡∏¥‡∏î‡∏≤ ‡∏ß‡∏µ‡∏£‡∏∞‡∏ß‡∏∏‡∏í‡∏¥‡∏û‡∏á‡∏®‡πå‡∏ô‡∏≤‡∏¢‡∏ä‡∏ô‡∏≤‡∏ò‡∏¥‡∏õ ‡∏ö‡∏∏‡∏ç‡∏°‡∏≤‡∏®‡∏¥‡∏£‡∏¥‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ä‡∏ß‡∏±‡∏•‡∏û‡∏±‡∏ä‡∏£ ‡∏ß‡∏¥‡∏ä‡∏±‡∏¢‡∏®‡∏¥‡∏£‡∏¥‡∏£‡∏±‡∏ï‡∏ô‡πå‡∏ô‡∏≤‡∏¢‡∏ä‡∏≤‡∏Ñ‡∏£‡∏¥‡∏© ‡∏ö‡∏ß‡∏£‡∏Å‡∏¥‡∏à‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ä‡∏≤‡∏•‡∏¥‡∏™‡∏≤ ‡∏û‡∏£‡∏™‡∏∏‡∏Ç‡∏à‡∏±‡∏ô‡∏ó‡∏£‡∏≤‡∏ô‡∏≤‡∏¢‡∏ç‡∏≤‡∏ì‡∏û‡∏±‡∏í‡∏ô‡πå ‡∏™‡∏∏‡∏Ç‡πÄ‡∏Å‡∏©‡∏°‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ê‡∏ì‡∏¥‡∏ä‡∏≤ ‡∏à‡∏£‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏£‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ê‡∏¥‡∏ï‡∏≤‡∏£‡∏µ‡∏¢‡πå ‡∏õ‡∏≤‡∏ô‡∏™‡∏á‡πà‡∏≤‡∏ô‡∏≤‡∏¢‡∏ì‡∏û‡∏á‡∏®‡πå ‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡πÄ‡∏ô‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ì‡∏±‡∏è‡∏ê‡∏ì‡∏¥‡∏ä‡∏≤ ‡∏™‡∏∏‡∏î‡∏Ñ‡∏á‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ì‡∏±‡∏ê‡∏Å‡∏§‡∏ï‡∏≤ ‡∏®‡∏£‡∏µ‡∏ß‡∏¥‡πÄ‡∏ä‡∏µ‡∏¢‡∏£‡∏ô‡∏≤‡∏¢‡∏ì‡∏±‡∏ê‡∏ä‡∏ô‡∏ô‡∏ó‡πå ‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏ï‡∏≤‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ì‡∏±‡∏ê‡∏ì‡∏¥‡∏ä‡∏≤ ‡∏Ç‡∏ß‡∏≤‡∏•‡∏≥‡∏ò‡∏≤‡∏£‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ì‡∏±‡∏ê‡∏ò‡∏¥‡∏î‡∏≤ ‡∏≠‡∏£‡∏∏‡∏ì‡πÅ‡∏™‡∏á‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ï‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡∏ã‡∏≤‡∏ß‡∏≤‡∏ï‡∏µ ‡∏≠‡∏±‡∏•‡∏≠‡∏≤‡∏ï‡∏±‡∏™‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ò‡∏±‡∏ç‡∏£‡∏î‡∏≤ ‡πÇ‡∏ó‡∏ò‡∏£‡∏±‡∏ï‡∏ô‡πå‡∏ô‡∏≤‡∏¢‡∏ò‡∏¥‡∏ï‡∏¥‡∏ß‡∏∏‡∏í‡∏¥ ‡πÄ‡∏û‡∏ä‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏≠‡∏á‡∏ô‡∏≤‡∏¢‡∏ò‡∏µ‡∏£‡πÄ‡∏°‡∏ò ‡πÅ‡∏™‡∏á‡∏≠‡∏£‡∏∏‡∏ì‡∏ô‡∏≤‡∏¢‡∏ô‡∏û‡πÄ‡∏Å‡πâ‡∏≤ ‡∏ß‡∏¥‡∏ß‡∏±‡∏í‡∏ä‡∏¢‡∏≤‡∏á‡∏Å‡∏π‡∏•‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ô‡∏†‡∏±‡∏™‡∏ß‡∏£‡∏£‡∏ì ‡πÅ‡∏ú‡∏•‡∏á‡∏®‡∏£‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ô‡∏±‡∏ä‡∏ä‡∏≤ ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏ß‡∏á‡∏®‡πå‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ô‡∏±‡∏ã‡∏£‡∏µ‡∏¢‡∏≤ ‡∏ö‡∏∏‡∏ç‡∏ä‡∏π‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ô‡∏±‡∏ô‡∏ï‡∏£‡∏≤ ‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ô‡πâ‡∏≠‡∏¢‡∏ô‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏ß‡∏¥‡∏ä‡∏ç‡πå ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏ß‡∏¥‡πÑ‡∏•‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏õ‡∏£‡∏≤‡∏á‡∏Ñ‡πå‡∏ó‡∏¥‡∏û‡∏¢‡πå ‡∏ö‡∏∏‡∏ç‡∏°‡∏µ‡∏ß‡∏¥‡πÄ‡∏®‡∏©‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏õ‡∏£‡∏≤‡∏ì‡∏õ‡∏£‡∏¥‡∏¢‡∏≤ ‡∏à‡πà‡∏≤‡∏û‡∏•‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏õ‡∏≤‡∏ì‡∏¥‡∏™‡∏£‡∏≤ ‡∏®‡∏£‡∏µ‡∏≠‡∏≤‡∏à‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏û‡∏£‡∏õ‡∏ß‡∏µ‡∏ì‡πå ‡∏ö‡∏∏‡∏ç‡∏ô‡∏≥‡∏ô‡∏≤‡∏¢‡∏û‡∏¥‡∏ò‡∏¥‡∏ô‡∏±‡∏ô‡∏ó‡πå ‡∏™‡∏±‡∏ï‡∏ï‡∏¥‡∏¢‡∏≤‡∏£‡∏±‡∏Å‡∏©‡πå‡∏ô‡∏≤‡∏¢‡∏û‡∏∏‡∏í‡∏¥‡∏û‡∏á‡∏®‡πå ‡∏ú‡∏î‡∏∏‡∏á‡∏ß‡∏±‡∏í‡∏ô‡∏∞‡πÇ‡∏ä‡∏Ñ‡∏ô‡∏≤‡∏¢‡∏†‡∏π‡∏°‡∏¥‡∏£‡∏û‡∏µ ‡∏ö‡∏π‡∏£‡∏ì‡∏∞‡∏™‡∏°‡∏ó‡∏ö‡∏ô‡∏≤‡∏¢‡∏†‡∏π‡∏ß‡πÄ‡∏î‡∏ä ‡∏ô‡∏¥‡∏•‡∏Ñ‡∏ï‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏°‡∏ô‡∏ì‡∏¥‡∏ä‡∏ä‡∏≤ ‡∏ö‡∏∏‡∏ç‡∏ô‡∏≥‡∏ô‡∏≤‡∏¢‡∏£‡∏±‡∏ä‡∏ä‡∏≤‡∏ô‡∏ô‡∏ó‡πå ‡∏Ç‡∏°‡∏¥‡πâ‡∏ô‡∏ó‡∏≠‡∏á‡∏ô‡∏≤‡∏¢‡∏ß‡∏ä‡∏¥‡∏£‡∏ß‡∏¥‡∏ó‡∏¢‡πå ‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏ß‡∏á‡∏®‡πå‡∏ô‡∏≤‡∏¢‡∏ß‡∏®‡∏¥‡∏ô ‡πÄ‡∏≠‡∏µ‡πà‡∏¢‡∏°‡∏ï‡πà‡∏≠‡∏°‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏®‡∏∏‡∏†‡∏¥‡∏™‡∏£‡∏≤ ‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå‡∏™‡∏¥‡∏ô‡∏ô‡∏≤‡∏¢‡∏™‡∏∏‡∏£‡∏û‡∏á‡∏©‡πå ‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏´‡∏ó‡∏±‡∏¢‡∏ô‡∏±‡∏ô‡∏ó‡πå ‡πÄ‡∏ó‡∏û‡∏Å‡∏≥‡∏õ‡∏ô‡∏≤‡∏ó‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏≠‡∏ä‡∏¥‡∏£‡∏ç‡∏≤‡∏ì‡πå ‡∏•‡∏≥‡∏û‡∏£‡∏´‡∏°‡πÅ‡∏Å‡πâ‡∏ß‡∏ô‡∏≤‡∏¢‡∏≠‡∏±‡∏Ñ‡∏£‡∏ß‡∏¥‡∏ó‡∏¢‡πå ‡∏ô‡∏¥‡∏ò‡∏¥‡∏ö‡∏∏‡∏ç‡∏ç‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡πÑ‡∏≠‡∏•‡∏î‡∏≤ ‡∏ó‡∏≤‡∏´‡∏∞‡∏û‡∏£‡∏´‡∏°‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡πÅ‡∏û‡∏£‡∏ó‡∏≠‡∏á ‡πÄ‡∏û‡∏≠‡∏£‡∏±‡∏ï‡∏ô‡πå‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏≠‡∏†‡∏¥‡∏™‡∏£‡∏≤ ‡∏ô‡∏∏‡∏ï‡∏†‡∏π‡∏ï‡∏¥‡∏û‡∏á‡∏®‡πå‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏Å‡∏ß‡∏¥‡∏ô‡∏ò‡∏£ ‡πÄ‡∏°‡∏Ü‡∏∞‡∏à‡∏≥‡∏£‡∏π‡∏ç‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏Å‡∏≤‡∏ô‡∏ï‡∏¥‡∏°‡∏≤ ‡∏°‡∏±‡∏ó‡∏Å‡∏¥‡∏à‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏à‡∏≤‡∏£‡∏¥‡∏ç‡∏î‡∏≤ ‡∏≠‡∏¥‡∏ô‡∏≠‡∏±‡∏ç‡∏ä‡∏±‡∏ç‡∏ô‡∏≤‡∏¢‡πÇ‡∏ä‡∏Ñ‡∏ä‡∏±‡∏¢ ‡∏≠‡∏£‡∏¥‡∏¢‡∏∞‡∏ö‡∏∏‡∏ç‡∏™‡∏Å‡∏∏‡∏•‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ì‡∏†‡∏±‡∏ó‡∏£ ‡∏î‡∏≥‡πÅ‡∏Å‡πâ‡∏ß‡∏ô‡∏≤‡∏¢‡∏ì‡∏±‡∏ê‡∏î‡∏ô‡∏¢‡πå ‡∏≠‡∏†‡∏¥‡∏£‡∏ï‡∏¥‡∏ä‡∏±‡∏¢‡∏®‡∏¥‡∏£‡∏¥‡∏Å‡∏∏‡∏•‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ó‡∏±‡∏®‡∏ô‡πå‡∏™‡∏∏‡∏î‡∏≤ ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ß‡∏¥‡πÄ‡∏®‡∏©‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ò‡∏µ‡∏£‡∏¥‡∏®‡∏£‡∏≤ ‡∏≠‡∏¥‡∏ô‡∏ï‡∏£‡∏≤‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ô‡∏£‡∏°‡∏• ‡∏û‡∏£‡∏´‡∏°‡πÇ‡∏ä‡∏ï‡∏¥‡∏ô‡∏≤‡∏¢‡∏õ‡∏¥‡∏ï‡∏¥‡∏û‡∏±‡∏ï‡∏ô‡πå ‡∏£‡∏±‡∏ï‡∏ô‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡πÄ‡∏õ‡∏°‡∏¥‡∏Å‡∏≤ ‡∏ö‡∏∏‡∏£‡∏ì‡∏®‡∏¥‡∏£‡∏¥‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏û‡∏£‡∏†‡∏£‡∏ì‡πå ‡∏ö‡∏∏‡∏ç‡∏¢‡∏π‡πà‡∏Æ‡∏á‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏†‡∏≤‡∏ô‡∏¥‡∏•‡∏ô‡∏≤‡∏ñ ‡∏°‡∏≤‡∏ô‡∏∞‡∏ò‡∏±‡∏ç‡∏ç‡∏≤‡∏ô‡∏≤‡∏¢‡∏†‡∏≤‡∏™‡∏Å‡∏£ ‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏°‡∏®‡∏≤‡∏£‡∏±‡∏®‡∏°‡πå ‡∏û‡∏∏‡∏ó‡∏ò‡∏∞‡πÑ‡∏ä‡∏¢‡∏ó‡∏±‡∏®‡∏ô‡πå‡∏ô‡∏≤‡∏¢‡∏£‡∏±‡∏ê‡∏ò‡∏µ‡∏£‡πå ‡∏û‡∏ô‡∏¥‡∏ï‡∏à‡∏¥‡∏ô‡∏î‡∏≤‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ß‡∏¥‡∏£‡∏±‡∏•‡∏û‡∏±‡∏ä‡∏£ ‡∏Ñ‡∏∏‡∏ì‡∏≤‡∏™‡∏ñ‡∏¥‡∏ï‡∏¢‡πå‡∏ä‡∏±‡∏¢‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏®‡∏®‡∏¥‡∏ô‡∏¥‡∏†‡∏≤ ‡πÅ‡∏Å‡πâ‡∏ß‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì‡πå‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏∏‡∏ä‡∏±‡∏ç‡∏ç‡∏≤ ‡∏´‡∏ô‡∏π‡∏¢‡∏¥‡πâ‡∏°‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏∏‡∏†‡∏±‡∏™‡∏™‡∏£‡∏≤ ‡∏§‡∏Å‡∏©‡πå‡∏£‡∏±‡∏ï‡∏ô‡∏µ‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏∏‡∏°‡∏≤‡∏•‡∏µ ‡∏ô‡∏¥‡∏°‡∏¥‡∏ï‡∏£‡∏°‡∏á‡∏Ñ‡∏•‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡πÅ‡∏™‡∏á‡∏ï‡∏∞‡∏ß‡∏±‡∏ô ‡∏ö‡∏∏‡∏©‡∏õ‡∏ß‡∏ô‡∏¥‡∏ä";

const DRUGS=[
    {n:"Paracetamol",a:"Analgesic / Antipyretic"},{n:"Amoxicillin",a:"Antibiotic (Penicillin)"},{n:"Cetirizine",a:"Antihistamine Gen 2"},{n:"Omeprazole",a:"Proton Pump Inhibitor (PPI)"},{n:"Simvastatin",a:"HMG-CoA Reductase Inhibitor (Statin)"},{n:"Metformin",a:"Biguanide (‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô)"},{n:"Amlodipine",a:"Calcium Channel Blocker (CCB)"},{n:"Ibuprofen",a:"NSAIDs (COX-1/2 inhibitor)"},{n:"Prednisolone",a:"Systemic Corticosteroid"},{n:"Salbutamol",a:"Short-acting Œ≤2-agonist (SABA)"},{n:"Losartan",a:"Angiotensin II Receptor Blocker (ARB)"},{n:"Atorvastatin",a:"HMG-CoA Reductase Inhibitor (Statin)"},{n:"Clopidogrel",a:"P2Y12 Antiplatelet"},{n:"Gabapentin",a:"Anticonvulsant / Neuropathic pain"},{n:"Domperidone",a:"Dopamine Antagonist Antiemetic"},{n:"Lorazepam",a:"Benzodiazepine (anxiolytic)"},{n:"Tramadol",a:"Weak Opioid Analgesic"},{n:"Acetylcysteine",a:"Mucolytic / Antidote (paracetamol OD)"},{n:"Mefenamic Acid",a:"NSAIDs (NSAID fenamate)"},{n:"Enalapril",a:"ACE Inhibitor"},{n:"Propranolol",a:"Non-selective Beta-blocker"},{n:"Furosemide",a:"Loop Diuretic"},{n:"Warfarin",a:"Vitamin K Antagonist (Anticoagulant)"},{n:"Digoxin",a:"Cardiac Glycoside (inotrope)"},{n:"Azithromycin",a:"Macrolide Antibiotic"},{n:"Ciprofloxacin",a:"Fluoroquinolone Antibiotic"},{n:"Doxycycline",a:"Tetracycline Antibiotic"},{n:"Ceftriaxone",a:"3rd-gen Cephalosporin"},{n:"Diazepam",a:"Benzodiazepine (anticonvulsant/anxiolytic)"},{n:"Fluoxetine",a:"Selective Serotonin Reuptake Inhibitor (SSRI)"},{n:"Amitriptyline",a:"Tricyclic Antidepressant (TCA)"},{n:"Phenytoin",a:"Hydantoin Anticonvulsant (Na+ channel blocker)"},{n:"Chlorpheniramine (CPM)",a:"1st-gen Antihistamine (sedating)"},{n:"Loratadine",a:"2nd-gen Antihistamine (non-sedating)"},{n:"Fexofenadine",a:"3rd-gen Antihistamine (peripherally selective)"},{n:"Dextromethorphan",a:"NMDA Antagonist Antitussive"},{n:"Bromhexine",a:"Mucolytic (depolymerizes mucopolysaccharides)"},{n:"Famotidine",a:"H2-Receptor Antagonist"},{n:"Hyoscine (Scopolamine)",a:"Anticholinergic / Antispasmodic"},{n:"Loperamide",a:"Peripheral Opioid Receptor Agonist (Antidiarrheal)"},{n:"Glibenclamide",a:"Sulfonylurea (closes K-ATP channel)"},{n:"Allopurinol",a:"Xanthine Oxidase Inhibitor (antigout)"},{n:"Colchicine",a:"Microtubule Inhibitor (acute gout)"},{n:"Diclofenac",a:"NSAIDs (acetic acid derivative)"},{n:"Naproxen",a:"NSAIDs (propionic acid derivative)"},{n:"Celecoxib",a:"Selective COX-2 Inhibitor"},{n:"Aspirin (Low dose)",a:"Irreversible COX-1 Inhibitor / Antiplatelet"},{n:"Ergotamine",a:"Serotonin Agonist Antimigraine"},{n:"Norfloxacin",a:"Fluoroquinolone (urinary/GI tract)"},{n:"ORS",a:"Oral Rehydration Solution (WHO formula)"}
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentUser=null, userData=null, unsub=null;
let mTrack='all', mSearch='';
let qScore=0, qAnswer=null, qHigh=0;
let dqScore=0, dqAnswer=null, dqHigh=0;
let curDrug=null, tradeIdx=null;
let __quizTop5Posted=false, __drugTop5Posted=false; // guard ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ spam top5% news

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initStudents() {
    const sci=R_SCI.map(s=>{const[nick,rest]=s.split(' (');return{nickname:nick,id:rest.replace(')',''),track:'sci'};});
    const care=R_CARE.map(s=>{const[nick,rest]=s.split(' (');return{nickname:nick,id:rest.replace(')',''),track:'care'};});
    const names=RN.split(/(?=‡∏ô‡∏≤‡∏¢|‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß)/).filter(n=>n.trim()).map(n=>n.replace(/^‡∏ô‡∏≤‡∏¢|^‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß/,'').trim());
    // RN ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏° ID sort ascending ‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô (Sci+Care ‡∏£‡∏ß‡∏°) ‚Äî map ‡∏´‡∏•‡∏±‡∏á sort
    const all=[...sci,...care].sort((a,b)=>a.id.localeCompare(b.id));
    all.forEach((s,i)=>{s.realName=names[i]||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';});
    window.__students=all;
}
initStudents();

// ‚îÄ‚îÄ MEMBER LIVE DATA CACHE ‚îÄ‚îÄ
window.__fbUsers = {}; // studentId -> liveData
window.__guestUsers = []; // guest users list
async function loadFbUsers() {
    try {
        const snap = await getDocs(collection(db,"users"));
        window.__guestUsers = []; // reset guest list
        snap.forEach(d => {
            const x = d.data();
            if (!x.studentId) return;
            if (x.track === 'guest') {
                window.__guestUsers.push(x); // ‡πÄ‡∏Å‡πá‡∏ö guest ‡πÅ‡∏¢‡∏Å
            } else {
                window.__fbUsers[x.studentId] = x; // ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥
            }
        });
        if (window.__tab === 'members') {
            const g = document.getElementById('mgrid');
            if (g) g.innerHTML = memberGrid();
            updateGuestBadge();
        }
    } catch(e) {}
}
function updateGuestBadge(){
    const el=document.getElementById('guest-count-badge');
    if(el) el.textContent=`üëã Guest ${(window.__guestUsers||[]).length} ‡∏Ñ‡∏ô`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  AUTH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.loginGoogle=async()=>{
    try{provider.setCustomParameters({prompt:'select_account'});const r=await signInWithPopup(auth,provider);await ensureDoc(r.user);}
    catch(e){if(e.code!=='auth/popup-closed-by-user')toast("Login ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","error");}
};
window.logoutUser=async()=>{try{await signOut(auth);}catch(e){}currentUser=userData=null;window.__fbUsers={};window.__tab='home';renderTab('home');};

async function ensureDoc(u){
    const ref=doc(db,"users",u.uid);const snap=await getDoc(ref);
    if(!snap.exists())await setDoc(ref,{uid:u.uid,name:u.displayName,email:u.email,googlePhoto:u.photoURL,customPhoto:null,coins:200,pets:[],eggs:[],activePet:null,studentId:null,nickname:null,realName:null,track:null,quizHigh:0,drugHigh:0,lastDaily:null,petLastDaily:null,createdAt:serverTimestamp()});
}

onAuthStateChanged(auth,async u=>{
    currentUser=u;
    if(u){
        await ensureDoc(u);
        if(unsub)unsub();
        __petDailyChecked=false; // reset guard ‡πÄ‡∏°‡∏∑‡πà‡∏≠ login ‡πÉ‡∏´‡∏°‡πà
        unsub=onSnapshot(doc(db,"users",u.uid),snap=>{userData=snap.data();qHigh=userData?.quizHigh||0;dqHigh=userData?.drugHigh||0;renderAll();checkDaily();});
        loadFbUsers();
        setTimeout(checkPetDaily, 1500); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏´‡∏•‡∏±‡∏á data ‡πÇ‡∏´‡∏•‡∏î
    } else renderAll();
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DAILY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let __petDailyChecked = false; // guard ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ award ‡∏ã‡πâ‡∏≥‡πÉ‡∏ô session ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
async function checkDaily(){
    if(!currentUser||!userData)return;
    const last=userData.lastDaily?.toDate?.();const now=new Date();
    const btn=document.getElementById('daily-btn');
    // reset ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏∑‡∏ô ‚Äî ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ lastDaily ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô calendar day ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤
    const sameDay=last&&last.toDateString()===now.toDateString();
    if(btn)btn.classList.toggle('ready',!last||!sameDay);
}
async function checkPetDaily(){
    if(!currentUser||!userData||__petDailyChecked)return;
    const pet=activePet();
    if(pet?.effect==='daily50'||pet?.effect==='all'||pet?.effect==='rainbow'){
        const pl=userData.petLastDaily?.toDate?.();
        const now=new Date();
        if(!pl||(now-pl)>23*3600000){
            __petDailyChecked=true;
            const b=pet.effect==='all'?100:pet.effect==='rainbow'?100:50;
            await updateDoc(doc(db,"users",currentUser.uid),{coins:increment(b),petLastDaily:serverTimestamp()});
            toast(`${pet.emoji} ${pet.name} ‡πÉ‡∏´‡πâ daily +${b}ü™ô!`,"success");
        }
    }
}
window.claimDaily=async()=>{
    if(!currentUser)return;
    const btn=document.getElementById('daily-btn');
    if(!btn?.classList.contains('ready')){toast("‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ!","info");return;}
    const base=50;
    await updateDoc(doc(db,"users",currentUser.uid),{coins:increment(base),lastDaily:serverTimestamp()});
    btn.classList.remove('ready');
    toast(`üéÅ Daily +${base}ü™ô!`,"success");
    confetti({particleCount:80,spread:60,origin:{y:0.6}});
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function activePet(){if(!userData?.activePet||!userData?.pets)return null;return userData.pets.find(p=>p.id===userData.activePet)||null;}
function coinMulti(){const p=activePet();if(!p)return 1;if(p.effect==='coin+10')return 1.1;if(p.effect==='coin+15')return 1.15;if(p.effect==='coinx2')return 2;if(p.effect==='all')return 3;return 1;}
function scoreMulti(){const p=activePet();return(p?.effect==='scorex2'||p?.effect==='all')?2:1;}
function scoreBonus(){return activePet()?.effect==='score+5'?5:0;}
window.awardCoins=async(base)=>{if(!currentUser)return base;const final=Math.floor(base*coinMulti());await updateDoc(doc(db,"users",currentUser.uid),{coins:increment(final)});if(final!==base)toast(`${activePet().emoji} Effect! +${final} ‡πÅ‡∏ó‡∏ô +${base}`,"success");return final;};
function myPhoto(){if(!userData)return null;return userData.customPhoto||userData.googlePhoto||`https://ui-avatars.com/api/?name=${encodeURIComponent(userData.name||'?')}&size=256`;}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  NEWS FEED
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function postNews(icon, msg) {
    try {
        await addDoc(collection(db,"news"), {icon, msg, ts: serverTimestamp()});
        loadTicker();
    } catch(e){}
}

async function loadTicker() {
    try {
        const q=query(collection(db,"news"),orderBy("ts","desc"),limit(5));
        const snap=await getDocs(q);
        let items=[];
        snap.forEach(d=>{const x=d.data();items.push(`${x.icon} ${x.msg}`);});
        if(!items.length)items=['‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà RxTU10 Dashboard! üéâ'];
        document.getElementById('ticker-text').textContent=items.join('  ‚Ä¢  ');
    } catch(e){}
}

window.openFeed=async()=>{
    document.getElementById('feed-modal').classList.add('active');
    try {
        const q=query(collection(db,"news"),orderBy("ts","desc"),limit(30));
        const snap=await getDocs(q);
        let html='';
        snap.forEach(d=>{
            const x=d.data();
            const ts=x.ts?.toDate?.();
            const timeStr=ts?ts.toLocaleString('th-TH',{hour:'2-digit',minute:'2-digit',day:'numeric',month:'short'}):'';
            html+=`<div class="feed-item"><div class="feed-icon">${x.icon}</div><div><div class="feed-msg">${x.msg}</div><div class="feed-time">${timeStr}</div></div></div>`;
        });
        document.getElementById('feed-list').innerHTML=html||'<div style="text-align:center;color:var(--muted);padding:20px">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πà‡∏≤‡∏ß</div>';
    } catch(e){document.getElementById('feed-list').innerHTML='<div style="color:#ef4444;text-align:center;padding:16px">‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</div>';}
};
window.closeFeed=()=>document.getElementById('feed-modal').classList.remove('active');

// Megaphone
window.openMega=()=>{
    if(!currentUser){toast("Login ‡∏Å‡πà‡∏≠‡∏ô","error");return;}
    document.getElementById('mega-coins').textContent=(userData?.coins||0).toLocaleString();
    document.getElementById('mega-text').value='';
    document.getElementById('mega-modal').classList.add('active');
};
window.closeMega=()=>document.getElementById('mega-modal').classList.remove('active');
window.sendMegaphone=async()=>{
    if(!currentUser||!userData){toast("Login ‡∏Å‡πà‡∏≠‡∏ô","error");return;}
    if((userData.coins||0)<MEGA_COST){toast(`‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏°‡πà‡∏û‡∏≠! ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ${MEGA_COST}ü™ô`,"error");return;}
    const msg=document.getElementById('mega-text').value.trim();
    if(!msg){toast("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°","error");return;}
    const name=userData.nickname?.split(' ')[0]||userData.name||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
    await updateDoc(doc(db,"users",currentUser.uid),{coins:increment(-MEGA_COST)});
    await postNews("üì£",`${name}: ${msg}`);
    closeMega();
    toast("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß! üì£","success");
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STUDENT LINKING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.openLinkModal=()=>{
    if(!currentUser){toast("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Login ‡∏Å‡πà‡∏≠‡∏ô","error");return;}
    document.getElementById('link-input').value='';document.getElementById('link-error').textContent='';document.getElementById('link-preview').style.display='none';document.getElementById('link-modal').classList.add('active');
};
window.closeLinkModal=()=>document.getElementById('link-modal').classList.remove('active');
window.showGuestSection=()=>{
    document.getElementById('link-section-student').style.display='none';
    document.getElementById('link-section-guest').style.display='block';
    document.getElementById('guest-name-input').focus();
};
window.showStudentSection=()=>{
    document.getElementById('link-section-guest').style.display='none';
    document.getElementById('link-section-student').style.display='block';
};
window.confirmGuest=async()=>{
    const name=document.getElementById('guest-name-input').value.trim();
    const err=document.getElementById('guest-error');
    if(!name){err.textContent='‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô';return;}
    if(name.length<2){err.textContent='‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£';return;}
    if(!currentUser)return;
    // Guest: studentId='guest', track='guest', nickname=name ‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏≠‡∏á
    const welcomeEggs=[1,2].map(()=>{const p=rollPet();return{eggId:`welcome_${Date.now()}_${Math.random().toString(36).slice(2)}`,petId:p.id,petEmoji:p.emoji,petName:p.name,petRarity:p.rarity,petEffect:p.effect,petDesc:p.desc,petInstId:p.instId,hatchMins:p.hatchMins,startedAt:null};});
    await updateDoc(doc(db,"users",currentUser.uid),{studentId:'guest_'+currentUser.uid.slice(0,8),nickname:name,realName:name,track:'guest',eggs:arrayUnion(welcomeEggs[0],welcomeEggs[1])});
    closeLinkModal();
    toast(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${name}! üéÅ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÑ‡∏Ç‡πà 2 ‡∏ü‡∏≠‡∏á!`,"success");
    confetti({particleCount:120,spread:70,origin:{y:0.5}});
    await postNews("üëã",`${name} ‡πÄ‡∏û‡∏¥‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° RxTU10 Dashboard ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏∞ Guest!`);
};
window.previewLink=()=>{
    const val=document.getElementById('link-input').value.trim();const found=window.__students?.find(s=>s.id===val);
    const err=document.getElementById('link-error');const prev=document.getElementById('link-preview');
    if(!found){err.textContent='‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ';prev.style.display='none';return;}
    err.textContent='';document.getElementById('lp-nick').textContent=found.nickname;document.getElementById('lp-name').textContent=found.realName;
    const tb=document.getElementById('lp-track');tb.textContent=found.track.toUpperCase();tb.style.background=found.track==='sci'?'var(--sci)':'var(--care)';
    prev.style.display='block';prev.dataset.sid=val;
};
window.confirmLink=async()=>{
    if(userData?.studentId){toast("‡∏ú‡∏π‡∏Å‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏•‡πâ‡∏ß!","info");closeLinkModal();return;}
    const prev=document.getElementById('link-preview');if(prev.style.display==='none'){toast("‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏Å‡πà‡∏≠‡∏ô","error");return;}
    const sid=prev.dataset.sid;const found=window.__students?.find(s=>s.id===sid);if(!found||!currentUser)return;
    const confirmBtn=document.querySelector('#link-section-student .btn-gold');if(confirmBtn)confirmBtn.disabled=true;
    const all=await getDocs(collection(db,"users"));let claimed=false;
    all.forEach(d=>{if(d.data().studentId===sid&&d.id!==currentUser.uid)claimed=true;});
    if(claimed){toast("‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß","error");if(confirmBtn)confirmBtn.disabled=false;return;}
    // ‡∏°‡∏≠‡∏ö‡πÑ‡∏Ç‡πà 2 ‡∏ü‡∏≠‡∏á‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö
    const welcomeEggs=[1,2].map(()=>{const p=rollPet();return{eggId:`welcome_${Date.now()}_${Math.random().toString(36).slice(2)}`,petId:p.id,petEmoji:p.emoji,petName:p.name,petRarity:p.rarity,petEffect:p.effect,petDesc:p.desc,petInstId:p.instId,hatchMins:p.hatchMins,startedAt:null};});
    await updateDoc(doc(db,"users",currentUser.uid),{studentId:sid,nickname:found.nickname,realName:found.realName,track:found.track,eggs:arrayUnion(welcomeEggs[0],welcomeEggs[1])});
    closeLinkModal();toast(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${found.nickname}! üéÅ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÑ‡∏Ç‡πà 2 ‡∏ü‡∏≠‡∏á!`,"success");
    confetti({particleCount:150,spread:80,origin:{y:0.5}});
    await postNews("üîó",`${found.nickname} ‡πÄ‡∏û‡∏¥‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° RxTU10 Dashboard!`);
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PHOTO UPLOAD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.triggerPhoto=()=>document.getElementById('photo-input').click();
window.handlePhoto=async(e)=>{
    const file=e.target.files[0];if(!file||!currentUser)return;
    if(!file.type.startsWith('image/')){toast("‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô","error");return;}
    if(file.size>800*1024){toast("‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô 800KB","error");return;}
    toast("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î...","info");
    const reader=new FileReader();
    reader.onload=ev=>{const img=new Image();img.onload=async()=>{
        const canvas=document.createElement('canvas');const MAX=300;let w=img.width,h=img.height;
        if(w>h){if(w>MAX){h=h*(MAX/w);w=MAX;}}else{if(h>MAX){w=w*(MAX/h);h=MAX;}}
        canvas.width=w;canvas.height=h;canvas.getContext('2d').drawImage(img,0,0,w,h);
        const b64=canvas.toDataURL('image/jpeg',0.75);
        await updateDoc(doc(db,"users",currentUser.uid),{customPhoto:b64});
        toast("‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!","success");
    };img.src=ev.target.result;};
    reader.readAsDataURL(file);e.target.value='';
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  GACHA & HATCH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function rollPet(){const r=Math.random();let c=0;for(const p of PETS){c+=p.rate;if(r<=c)return{...p,instId:Date.now()+Math.random()};}return{...PETS[0],instId:Date.now()};}

window.buyEgg=async()=>{
    if(!currentUser||!userData){toast("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Login","error");return;}
    if(userData.coins<EGG_COST){toast(`‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏°‡πà‡∏û‡∏≠! ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ${EGG_COST}ü™ô`,"error");return;}
    const pet=rollPet();
    const egg={eggId:Date.now()+'_'+Math.random().toString(36).slice(2),petId:pet.id,petEmoji:pet.emoji,petName:pet.name,petRarity:pet.rarity,petEffect:pet.effect,petDesc:pet.desc,petInstId:pet.instId,hatchMins:pet.hatchMins,startedAt:null};
    await updateDoc(doc(db,"users",currentUser.uid),{coins:increment(-EGG_COST),eggs:arrayUnion(egg)});
    toast("ü•ö ‡πÑ‡∏î‡πâ‡πÑ‡∏Ç‡πà‡πÅ‡∏•‡πâ‡∏ß! ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Inventory > ‡∏ü‡∏±‡∏Å","success");
};

window.startHatch=async(eggId)=>{
    if(!currentUser||!userData)return;
    const eggs=(userData.eggs||[]).map(e=>e.eggId===eggId?{...e,startedAt:Date.now()}:e);
    await updateDoc(doc(db,"users",currentUser.uid),{eggs});toast("üî• ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏Å‡πÅ‡∏•‡πâ‡∏ß!","info");
};

window.claimEgg=async(eggId)=>{
    if(!currentUser||!userData)return;
    const egg=(userData.eggs||[]).find(e=>e.eggId===eggId);if(!egg||!egg.startedAt)return;
    if(Date.now()<egg.startedAt+egg.hatchMins*60000){toast("‡∏¢‡∏±‡∏á‡∏ü‡∏±‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à!","error");return;}
    const newEggs=(userData.eggs||[]).filter(e=>e.eggId!==eggId);
    const pet={id:egg.petId,emoji:egg.petEmoji,name:egg.petName,rarity:egg.petRarity,effect:egg.petEffect,desc:egg.petDesc,instId:egg.petInstId};
    await updateDoc(doc(db,"users",currentUser.uid),{eggs:newEggs,pets:arrayUnion(pet)});
    showGachaResult(pet);
    if(pet.rarity!=='common'){
        const name=userData.nickname?.split(' ')[0]||userData.name||'?';
        const icons={rare:'‚ú®',epic:'üí•',legendary:'üåü'};
        await postNews(icons[pet.rarity]||'üéâ',`${name} ‡∏ü‡∏±‡∏Å‡πÑ‡∏î‡πâ ${pet.emoji} ${pet.name} [${RARITY[pet.rarity].label}]!`);
    }
};

function showGachaResult(pet){
    const cfg=RARITY[pet.rarity];
    document.getElementById('gacha-result').innerHTML=`
        <div class="gacha-inner" style="--glow:${cfg.glow}">
            <div class="gr-badge" style="background:${cfg.color}">${cfg.label}</div>
            <div class="gr-emoji">${pet.emoji}</div>
            <div class="gr-name">${pet.name}</div>
            <div class="gr-desc">${pet.desc}</div>
            <div class="gr-btns">
                <button class="btn-gold" onclick="setActive('${pet.id}');closeGacha()">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡∏¢!</button>
                <button class="btn-gray" onclick="closeGacha()">‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô</button>
            </div>
        </div>`;
    document.getElementById('gacha-modal').classList.add('active');
    const colors=pet.rarity==='legendary'?['#f59e0b','#fbbf24','#fff']:pet.rarity==='epic'?['#a855f7','#c084fc','#fff']:pet.rarity==='rare'?['#3b82f6','#60a5fa','#fff']:['#94a3b8'];
    confetti({particleCount:pet.rarity==='legendary'?200:pet.rarity==='epic'?120:60,spread:80,origin:{y:0.5},colors});
}
window.closeGacha=()=>document.getElementById('gacha-modal').classList.remove('active');

window.setActive=async(id)=>{if(!currentUser)return;await updateDoc(doc(db,"users",currentUser.uid),{activePet:id});toast("‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÅ‡∏•‡πâ‡∏ß!","success");loadFbUsers();};
window.unsetActive=async()=>{if(!currentUser)return;await updateDoc(doc(db,"users",currentUser.uid),{activePet:null});toast("‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÅ‡∏•‡πâ‡∏ß","info");loadFbUsers();};

window.showPetInfo=(petId)=>{
    const p=PETS.find(x=>x.id===petId)||(userData?.pets||[]).find(x=>x.id===petId);if(!p)return;
    const cfg=RARITY[p.rarity];
    document.getElementById('petinfo-content').innerHTML=`
        <div style="text-align:center">
            <div class="gr-badge" style="background:${cfg.color};display:inline-block;margin-bottom:8px">${cfg.label}</div>
            <div style="font-size:3.2rem;margin:5px 0;filter:drop-shadow(0 0 10px ${cfg.glow})">${p.emoji}</div>
            <div style="font-size:1.2rem;font-weight:800;margin-bottom:3px">${p.name}</div>
            <div style="color:var(--muted);font-size:0.78rem;margin-bottom:10px">‡πÄ‡∏ß‡∏•‡∏≤‡∏ü‡∏±‡∏Å: ${HATCH_LABELS[p.rarity]||''}</div>
            <div style="background:${cfg.bg};border:1.5px solid ${cfg.color}33;border-radius:11px;padding:11px;font-size:0.86rem">
                ‚ú® <b>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ:</b><br><span style="color:${cfg.color};font-weight:600">${p.desc}</span>
            </div>
        </div>`;
    const isActive=userData?.activePet===p.id;
    document.getElementById('petinfo-actions').innerHTML=`
        <button class="btn-gold" style="flex:1" onclick="${isActive?'unsetActive()':'setActive(\''+p.id+'\')' };closePetInfo()">${isActive?"üî¥ ‡πÄ‡∏≠‡∏≤‡∏≠‡∏≠‡∏Å":"üü¢ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô"}</button>
        <button class="btn-gray" style="flex:1" onclick="closePetInfo()">‡∏õ‡∏¥‡∏î</button>`;
    document.getElementById('petinfo-modal').classList.add('active');
};
window.closePetInfo=()=>document.getElementById('petinfo-modal').classList.remove('active');

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TRADE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.openTrade=()=>{if(!currentUser){toast("Login ‡∏Å‡πà‡∏≠‡∏ô","error");return;}tradeIdx=null;renderTradeList();document.getElementById('trade-panel').classList.add('active');};
window.closeTrade=()=>document.getElementById('trade-panel').classList.remove('active');
function renderTradeList(){const el=document.getElementById('trade-pets');if(!userData?.pets?.length){el.innerHTML='<p style="color:#94a3b8;text-align:center;padding:8px">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</p>';return;}el.innerHTML=userData.pets.map((p,i)=>{const c=RARITY[p.rarity];return`<div class="trade-item${tradeIdx===i?' sel':''}" onclick="pickTrade(${i})"><span style="font-size:1.4rem">${p.emoji}</span><div><div style="font-weight:600;font-size:0.82rem">${p.name}</div><div style="color:${c.color};font-size:0.68rem;font-weight:700">${c.label}</div></div></div>`;}).join('');}
window.pickTrade=i=>{tradeIdx=i;renderTradeList();};
window.sendTrade=async()=>{
    const email=document.getElementById('trade-email').value.trim();if(!email||tradeIdx===null){toast("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÅ‡∏•‡∏∞‡πÉ‡∏™‡πà email","error");return;}
    const pet=userData.pets[tradeIdx];const all=await getDocs(collection(db,"users"));let target=null;all.forEach(d=>{if(d.data().email===email)target=d;});
    if(!target){toast("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ","error");return;}
    const newPets=userData.pets.filter((_,i)=>i!==tradeIdx);
    await setDoc(doc(db,"users",currentUser.uid),{pets:newPets},{merge:true});await updateDoc(doc(db,"users",target.id),{pets:arrayUnion(pet)});
    toast(`‡∏™‡πà‡∏á ${pet.emoji}${pet.name} ‡πÉ‡∏´‡πâ ${email}!`,"success");closeTrade();tradeIdx=null;loadFbUsers();
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  QUIZ ‚Äî ‡∏ó‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.startQuiz=()=>{
    qScore=0;__quizTop5Posted=false;
    document.getElementById('q-score').textContent='0';
    document.getElementById('quiz-start').style.display='none';document.getElementById('quiz-play').style.display='block';nextQ();
};
window.nextQ=()=>{
    const s=window.__students;if(!s?.length)return;
    const st=s[Math.floor(Math.random()*s.length)];qAnswer=st.realName;
    document.getElementById('q-nick').textContent=st.nickname.split(' ')[0];
    let opts=[qAnswer];while(opts.length<4){const w=s[Math.floor(Math.random()*s.length)].realName;if(!opts.includes(w))opts.push(w);}
    opts.sort(()=>Math.random()-0.5);
    document.getElementById('q-opts').innerHTML=opts.map(o=>`<button class="q-btn" onclick="answerQ(this,'${o.replace(/'/g,"\\'")}')">${o}</button>`).join('');
};
window.answerQ=async(btn,ans)=>{
    document.querySelectorAll('.q-btn').forEach(b=>{
        b.disabled=true;
        if(b.textContent===qAnswer) b.classList.add('correct');
        else if(b.textContent===ans) b.classList.add('wrong');
    });
    if(ans===qAnswer){
        qScore++;
        const disp=qScore*scoreMulti()+scoreBonus();
        document.getElementById('q-score').textContent=disp;
        await window.awardCoins(5);
        confetti({particleCount:25,spread:50,origin:{y:0.7},colors:['#10b981']});
        setTimeout(nextQ,700);
    } else {
        const finalScore=qScore;
        const name=userData?.nickname?.split(' ')[0]||userData?.name||'?';
        if(currentUser&&finalScore>qHigh){
            qHigh=finalScore;
            await updateDoc(doc(db,"users",currentUser.uid),{quizHigh:finalScore});
            await postNews("üèÜ",`${name} ‡∏ó‡∏≥ High Score ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠: ${finalScore} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`);
        } else if(currentUser&&finalScore>=10&&!__quizTop5Posted){
            __quizTop5Posted=true;
            await postNews("üéÆ",`${name} ‡∏ó‡∏≥‡πÑ‡∏î‡πâ ${finalScore} ‡∏Ç‡πâ‡∏≠‡πÉ‡∏ô‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ ‚Äî Top 5%! üî•`);
        }
        setTimeout(()=>{
            document.getElementById('quiz-start').style.display='block';
            document.getElementById('quiz-play').style.display='none';
            document.getElementById('q-msg').innerHTML=`‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á‡∏Ñ‡∏∑‡∏≠ <b>${qAnswer}</b> | ‡πÑ‡∏Æ‡∏™‡∏Å‡∏≠‡∏£‡πå: ${Math.max(finalScore,qHigh)}`;
        },1000);
    }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DRUG QUIZ ‚Äî MCQ
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.startDrugQuiz=()=>{
    dqScore=0;__drugTop5Posted=false;
    document.getElementById('dq-score').textContent='0';
    document.getElementById('dquiz-start').style.display='none';document.getElementById('dquiz-play').style.display='block';nextDQ();
};
window.nextDQ=()=>{
    const d=DRUGS[Math.floor(Math.random()*DRUGS.length)];dqAnswer=d.a;
    document.getElementById('dq-drug').textContent=d.n;
    let opts=[d.a];while(opts.length<4){const w=DRUGS[Math.floor(Math.random()*DRUGS.length)].a;if(!opts.includes(w))opts.push(w);}
    opts.sort(()=>Math.random()-0.5);
    document.getElementById('dq-opts').innerHTML=opts.map(o=>`<button class="q-btn" onclick="answerDQ(this,'${o.replace(/'/g,"\\'")}')" style="font-size:0.76rem;text-align:left;padding:9px 10px">${o}</button>`).join('');
};
window.answerDQ=async(btn,ans)=>{
    document.querySelectorAll('#dq-opts .q-btn').forEach(b=>{b.disabled=true;if(b.textContent===dqAnswer)b.classList.add('correct');else if(b.textContent===ans)b.classList.add('wrong');});
    if(ans===dqAnswer){
        dqScore++;const disp=dqScore*scoreMulti()+scoreBonus();document.getElementById('dq-score').textContent=disp;
        await window.awardCoins(5);confetti({particleCount:25,spread:50,origin:{y:0.7},colors:['#3b82f6']});
        setTimeout(nextDQ,700);
    } else {
        const finalScore=dqScore;
        const name2=userData?.nickname?.split(' ')[0]||userData?.name||'?';
        if(currentUser&&finalScore>dqHigh){
            dqHigh=finalScore;await updateDoc(doc(db,"users",currentUser.uid),{drugHigh:finalScore});
            await postNews("üíä",`${name2} ‡∏ó‡∏≥ High Score ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡∏¢‡∏≤: ${finalScore} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`);
        } else if(currentUser&&finalScore>=10&&!__drugTop5Posted){
            __drugTop5Posted=true;
            await postNews("üéÆ",`${name2} ‡∏ó‡∏≥‡πÑ‡∏î‡πâ ${finalScore} ‡∏Ç‡πâ‡∏≠‡πÉ‡∏ô‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡∏¢‡∏≤ ‚Äî Top 5%! üî•`);
        }
        setTimeout(()=>{document.getElementById('dquiz-start').style.display='block';document.getElementById('dquiz-play').style.display='none';document.getElementById('dq-msg').innerHTML=`‡∏¢‡∏≤‡∏ä‡∏ô‡∏¥‡∏î‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ <b>${dqAnswer}</b> | ‡πÑ‡∏Æ‡∏™‡∏Å‡∏≠‡∏£‡πå: ${Math.max(finalScore,dqHigh)}`;},1000);
    }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  RENDER ENGINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.renderAll=()=>{
    const tab=window.__tab||'home';
    if(tab==='play'){
        const quizActive=document.getElementById('quiz-play')?.style.display==='block';
        const dquizActive=document.getElementById('dquiz-play')?.style.display==='block';
        if(quizActive||dquizActive) return; // ‡∏≠‡∏¢‡πà‡∏≤ re-render ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏Å‡∏°
    }
    renderTab(tab);
};

function renderTopBar(){} // top-bar removed ‚Äî login/coin/daily now in Home tab

window.switchTab=(tab)=>{
    window.__tab=tab;
    document.querySelectorAll('.bn-item').forEach(el=>el.classList.toggle('active',el.dataset.tab===tab));
    renderTab(tab);
    const mc=document.getElementById('main-content');if(mc)mc.scrollTop=0;
};

function renderTab(tab){
    const main=document.getElementById('main-content');
    if(tab==='home')    main.innerHTML=buildHome();
    if(tab==='members') main.innerHTML=buildMembers();
    if(tab==='play')    main.innerHTML=buildPlay();
    if(tab==='shop')    main.innerHTML=buildShop();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TAB: HOME
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const GOOGLE_SVG=`<svg width="18" height="18" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>`;
function buildHome(){
    if(!currentUser)return`
        <div class="login-card">
            <div style="font-size:4rem;margin-bottom:10px">üíä</div>
            <div style="font-size:1.6rem;font-weight:800;margin-bottom:4px">RxTU10</div>
            <div style="color:var(--muted);margin-bottom:22px;font-size:0.88rem">Class Dashboard ‚Äî Rx 2565 | Thammasat</div>
            <button class="btn-google big" onclick="loginGoogle()">${GOOGLE_SVG}Login ‡∏î‡πâ‡∏ß‡∏¢ Google</button>
            <p style="font-size:0.75rem;color:var(--muted);margin-top:12px">Login ‡πÅ‡∏•‡πâ‡∏ß‡∏ú‡∏π‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ó‡∏∏‡∏Å‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå</p>
        </div>`;
    const pet=activePet();const tc=userData?.track==='sci'?'var(--sci)':'var(--care)';
    const nc=(pet?.effect==='gold_name'||pet?.effect==='all')?'gold-name':(pet?.effect==='rainbow'?'rainbow-name':'');
    const linked=userData?.studentId;
    const profileBlock=linked?`
        <div class="profile-card">
            <div class="pc-img-wrap">
                <img src="${myPhoto()}" class="pc-img" onerror="this.onerror=null;this.src='https://ui-avatars.com/api/?name=?'">
                <button class="pc-cam" onclick="triggerPhoto()">üì∑</button>
            </div>
            <div class="pc-info" style="flex:1">
                <div class="pc-nick">${nc?`<span class="${nc}">${userData.nickname}</span>`:userData.nickname}${pet?' '+pet.emoji:''}</div>
                <div class="pc-real">${userData.realName}</div>
                <div class="pc-id">${userData.studentId}</div>
                <span class="track-badge" style="background:${tc}">${userData.track?.toUpperCase()}</span>
            </div>
        </div>
        <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:10px;flex-wrap:wrap">
            <div class="coin-pill" onclick="switchTab('shop')">ü™ô ${(userData.coins||0).toLocaleString()}</div>
            <button id="daily-btn" class="btn-daily" onclick="claimDaily()" title="Daily reward">üéÅ Daily</button>
            <button class="btn-out" style="width:auto;padding:6px 14px" onclick="logoutUser()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
        <div class="stats-row">
            <div class="stat-box"><div class="sb-icon">ü™ô</div><b>${(userData.coins||0).toLocaleString()}</b><small>‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç</small></div>
            <div class="stat-box"><div class="sb-icon">üë•</div><b>${userData.quizHigh||0}</b><small>Quiz Hi</small></div>
            <div class="stat-box"><div class="sb-icon">üíä</div><b>${userData.drugHigh||0}</b><small>Drug Hi</small></div>
        </div>`
        :`<div class="unlinked-card">
            <div class="ul-left">
                <img src="${myPhoto()}" class="ul-img" onerror="this.onerror=null;this.src='https://ui-avatars.com/api/?name=?'">
                <div>
                    <div style="font-weight:700">${userData?.name||''}</div>
                    <div style="font-size:0.76rem;color:var(--muted)">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ú‡∏π‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</div>
                </div>
            </div>
            <div style="display:flex;flex-direction:column;gap:5px;align-items:flex-end">
                <button class="btn-link" onclick="openLinkModal()">üîó ‡∏ú‡∏π‡∏Å‡∏£‡∏´‡∏±‡∏™</button>
                <button class="btn-out" style="font-size:0.7rem;padding:4px 8px" onclick="logoutUser()">‡∏≠‡∏≠‡∏Å</button>
            </div>
        </div>`;

    // Inventory: hatching eggs first
    const eggs=userData?.eggs||[];const pets=userData?.pets||[];const now=Date.now();
    const eggSection=eggs.length?`
        <div class="sec-head">ü•ö ‡∏ü‡∏±‡∏Å‡πÑ‡∏Ç‡πà</div><div class="card">${eggs.map(egg=>{
            const hatching=!!egg.startedAt;const done=hatching&&(now>=egg.startedAt+egg.hatchMins*60000);
            // ‡∏ã‡πà‡∏≠‡∏ô rarity ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ü‡∏±‡∏Å‡πÄ‡∏™‡∏£‡πá‡∏à ‚Äî ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏Ñ‡πà‡πÄ‡∏ß‡∏•‡∏≤‡∏ü‡∏±‡∏Å
            const cfg=done?RARITY[egg.petRarity]:{color:'var(--muted)',bg:'#f1f5f9',label:'???'};
            let timeLeft='';if(hatching&&!done){const ms=(egg.startedAt+egg.hatchMins*60000)-now;const h=Math.floor(ms/3600000);const m=Math.floor((ms%3600000)/60000);const s=Math.floor((ms%60000)/1000);timeLeft=h>0?`${h}‡∏ä‡∏° ${m}‡∏ô`:m>0?`${m}‡∏ô ${s}‡∏ß`:`${s}‡∏ß`;}
            const pct=hatching&&!done?Math.min(100,Math.floor((now-egg.startedAt)/(egg.hatchMins*60000)*100)):0;
            return`<div class="egg-bag-item" style="--rc:${cfg.color};--rb:${cfg.bg}">
                <div style="font-size:2rem;flex-shrink:0">${done?egg.petEmoji:'ü•ö'}</div>
                <div style="flex:1;min-width:0">
                    <div style="font-weight:700;font-size:0.86rem">${done?egg.petName:'‡πÑ‡∏Ç‡πà‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤ üîÆ'}</div>
                    <div style="font-size:0.68rem;color:${cfg.color};font-weight:700">${done?cfg.label+' ‚Ä¢ '+HATCH_LABELS[egg.petRarity]:'‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏ü‡∏±‡∏Å...'}</div>
                    ${hatching&&!done?`<div class="hatch-bar"><div class="hatch-fill" style="width:${pct}%;background:#94a3b8"></div></div><div style="font-size:0.67rem;color:var(--muted)">‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${timeLeft}</div>`:''}
                    ${done?`<div style="font-size:0.72rem;color:var(--care);font-weight:600">‚úÖ ‡∏ü‡∏±‡∏Å‡πÄ‡∏™‡∏£‡πá‡∏à!</div>`:''}
                    ${!hatching?`<div style="font-size:0.67rem;color:var(--muted)">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏Å</div>`:''}
                </div>
                ${done?`<button class="btn-gold sm" onclick="claimEgg('${egg.eggId}')">‡∏£‡∏±‡∏ö!</button>`:!hatching?`<button class="btn-gray sm" onclick="startHatch('${egg.eggId}')">üî• ‡∏ü‡∏±‡∏Å</button>`:`<span style="font-size:1.1rem">‚è≥</span>`}
            </div>`;
        }).join('')}</div>`:''

    const invBlock=pets.length===0?`<div class="inv-empty">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á ‚Äî ‡∏ü‡∏±‡∏Å‡πÑ‡∏Ç‡πà‡πÉ‡∏ô üõí Shop ‡∏Å‡πà‡∏≠‡∏ô!</div>`
        :`<div class="inv-grid">${pets.map(p=>{const cfg=RARITY[p.rarity];const on=p.id===userData?.activePet;return`<div class="inv-item${on?' on':''}" style="--rc:${cfg.color};--rb:${cfg.bg}" onclick="showPetInfo('${p.id}')"><div class="inv-em">${p.emoji}</div><div class="inv-nm">${p.name}</div><div style="font-size:0.55rem;color:${cfg.color};font-weight:700">${cfg.label}</div>${on?'<div class="inv-on">ON</div>':''}</div>`;}).join('')}</div>
        <div style="display:flex;gap:7px;justify-content:center;margin-top:8px">
            ${userData?.activePet?`<button class="btn-gray sm" onclick="unsetActive()">‡πÄ‡∏≠‡∏≤‡∏≠‡∏≠‡∏Å</button>`:''}
            ${pets.length?`<button class="btn-gray sm" onclick="openTrade()">üîÑ Trade</button>`:''}
            <button class="btn-gray sm" onclick="openMega()">üì£ ‡πÇ‡∏ó‡∏£‡πÇ‡∏Ç‡πà‡∏á</button>
        </div>`;

    return`${profileBlock}<input type="file" id="photo-input" accept="image/*" style="display:none" onchange="handlePhoto(event)">
        ${eggSection}
        <div class="sec-head">üêæ ‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</div><div class="card">${invBlock}</div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TAB: MEMBERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildMembers(){
    const all=window.__students||[];const sci=all.filter(s=>s.track==='sci').length;const care=all.filter(s=>s.track==='care').length;const tot=all.length;
    const guestCount=(window.__guestUsers||[]).length;
    return`
        <div class="card" style="margin-bottom:8px">
            <div style="font-weight:700;font-size:0.95rem;text-align:center;margin-bottom:8px">üíä RxTU10 ‚Äî ${tot} ‡∏Ñ‡∏ô</div>
            <div><div class="prog-bar"><div class="pb-sci" style="width:${(sci/tot*100).toFixed(1)}%"></div><div class="pb-care" style="width:${(care/tot*100).toFixed(1)}%"></div></div>
            <div class="prog-lbls"><span style="color:var(--sci)">Sci ${sci}</span><span style="color:var(--care)">Care ${care}</span></div></div>
            ${guestCount?`<div style="text-align:center;margin-top:8px"><button onclick="openGuestList()" id="guest-count-badge" style="background:none;border:1.5px solid var(--muted);border-radius:16px;padding:4px 12px;font-size:0.75rem;color:var(--muted);cursor:pointer;font-family:inherit">üëã Guest ${guestCount} ‡∏Ñ‡∏ô</button></div>`:''}
        </div>
        <div class="filter-row">
            <button class="fbtn${mTrack==='all'?' fa':''}" onclick="mFilter('all')">‡∏£‡∏ß‡∏° ${tot}</button>
            <button class="fbtn${mTrack==='sci'?' fs':''}" onclick="mFilter('sci')">Sci ${sci}</button>
            <button class="fbtn${mTrack==='care'?' fc':''}" onclick="mFilter('care')">Care ${care}</button>
        </div>
        <div class="search-box"><input class="srch-inp" id="msearch" placeholder="üîç ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô / ‡∏£‡∏´‡∏±‡∏™ / ‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á..." value="${mSearch}" oninput="mSearchFn(this.value)"></div>
        <div id="mgrid">${memberGrid()}</div>`;
}
function memberGrid(){
    let list=window.__students||[];
    if(mTrack!=='all')list=list.filter(s=>s.track===mTrack);
    if(mSearch){const q=mSearch.toLowerCase();list=list.filter(s=>s.nickname.toLowerCase().includes(q)||s.id.includes(q)||s.realName.toLowerCase().includes(q));}
    if(!list.length)return`<div style="text-align:center;color:var(--muted);padding:24px">‡πÑ‡∏°‡πà‡∏û‡∏ö</div>`;
    return`<div class="mgrid">${list.map(s=>{
        const tc=s.track==='sci'?'var(--sci)':'var(--care)';
        const live=window.__fbUsers?.[s.id];
        const photoSrc=live?.customPhoto||live?.googlePhoto||`img/${s.id}.jpg`;
        const def=`https://ui-avatars.com/api/?name=${encodeURIComponent(s.nickname.split(' ')[0])}&background=${s.track==='sci'?'2563eb':'10b981'}&color=fff&size=128`;
        const petData=live?.activePet?(live.pets||[]).find(p=>p.id===live.activePet):null;
        const petEmoji=petData?petData.emoji:'';
        const nc=(petData?.effect==='gold_name'||petData?.effect==='all')?'gold-name':(petData?.effect==='rainbow'?'rainbow-name':'');
        return`<div class="mcard" onclick="openProfileModal('${s.id}')">
            <div style="position:relative;width:56px;height:56px;margin-bottom:2px">
                <img src="${photoSrc}" onerror="this.onerror=null;this.src='${def}'" class="mc-img" style="width:56px;height:56px">
                ${petEmoji?`<div style="position:absolute;bottom:-3px;right:-3px;font-size:0.9rem;filter:drop-shadow(0 1px 2px rgba(0,0,0,.3))">${petEmoji}</div>`:''}
            </div>
            <div class="mc-nick">${nc?`<span class="${nc}">${s.nickname}</span>`:s.nickname}</div>
            <div class="mc-id">${s.id}</div>
            <span class="track-badge sm" style="background:${tc}">${s.track.toUpperCase()}</span>
        </div>`;
    }).join('')}</div>`;
}
window.mFilter=t=>{mTrack=t;const g=document.getElementById('mgrid');if(g)g.innerHTML=memberGrid();};
window.mSearchFn=v=>{mSearch=v;const g=document.getElementById('mgrid');if(g)g.innerHTML=memberGrid();};

window.openProfileModal=(id)=>{
    const s=window.__students?.find(x=>x.id===id);if(!s)return;
    // ‡πÉ‡∏ä‡πâ cache ‡πÅ‡∏ó‡∏ô getDocs ‚Äî ‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏µ‡∏¢ reads
    const liveData=window.__fbUsers?.[id]||null;
    const tc=s.track==='sci'?'var(--sci)':'var(--care)';
    const def=`https://ui-avatars.com/api/?name=${encodeURIComponent(s.nickname.split(' ')[0])}&background=${s.track==='sci'?'2563eb':'10b981'}&color=fff&size=256`;
    const photo=liveData?.customPhoto||liveData?.googlePhoto||`img/${s.id}.jpg`;
    const petData=liveData?.activePet?(liveData.pets||[]).find(p=>p.id===liveData.activePet):null;
    const nc=(petData?.effect==='gold_name'||petData?.effect==='all')?'gold-name':(petData?.effect==='rainbow'?'rainbow-name':'');
    const nickHtml=nc?`<span class="${nc}">${s.nickname}</span>`:s.nickname;
    document.getElementById('pm-content').innerHTML=`
        <img src="${photo}" onerror="this.onerror=null;this.src='${def}'" class="pm-img">
        <div class="pm-nick">${nickHtml}</div>
        <div class="pm-real">${s.realName}</div>
        <div class="pm-id">${s.id}</div>
        <span class="track-badge" style="background:${tc};margin-bottom:8px;display:inline-block">${s.track.toUpperCase()}</span>
        ${liveData?`
        <div class="pm-stats">
            <div class="pm-stat"><span>ü™ô</span><b>${(liveData.coins||0).toLocaleString()}</b><small>‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç</small></div>
            <div class="pm-stat"><span>üë•</span><b>${liveData.quizHigh||0}</b><small>Quiz Hi</small></div>
            <div class="pm-stat"><span>üíä</span><b>${liveData.drugHigh||0}</b><small>Drug Hi</small></div>
        </div>
        ${petData?`<div class="pm-pet-row"><div style="font-size:1.8rem">${petData.emoji}</div><div><div style="font-weight:700;font-size:0.86rem">${petData.name}</div><div style="font-size:0.72rem;color:var(--muted)">${petData.desc}</div></div></div>`:'<div style="color:var(--muted);font-size:0.78rem;margin-top:6px">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á active</div>'}
        `:'<div style="color:var(--muted);font-size:0.78rem;margin-top:8px">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ login</div>'}`;
    document.getElementById('profile-modal').classList.add('active');
};
window.closePM=()=>document.getElementById('profile-modal').classList.remove('active');

window.openGuestList=()=>{
    const guests=window.__guestUsers||[];
    if(!guests.length){toast("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Guest","info");return;}
    const html=guests.map(g=>{
        const photo=g.customPhoto||g.googlePhoto||`https://ui-avatars.com/api/?name=${encodeURIComponent(g.nickname||'?')}&background=64748b&color=fff&size=128`;
        const petData=g.activePet?(g.pets||[]).find(p=>p.id===g.activePet):null;
        return`<div style="display:flex;align-items:center;gap:10px;padding:9px 0;border-bottom:1px solid var(--border)">
            <img src="${photo}" style="width:40px;height:40px;border-radius:50%;object-fit:cover;border:2px solid var(--border)" onerror="this.onerror=null;this.src='https://ui-avatars.com/api/?name=?&background=64748b&color=fff'">
            <div style="flex:1">
                <div style="font-weight:700;font-size:0.88rem">${g.nickname||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'} ${petData?petData.emoji:''}</div>
                <div style="font-size:0.68rem;color:var(--muted)">ü™ô ${(g.coins||0).toLocaleString()} ‚Ä¢ Quiz ${g.quizHigh||0} ‚Ä¢ Drug ${g.drugHigh||0}</div>
            </div>
            <span style="background:#64748b;color:#fff;font-size:0.55rem;font-weight:700;padding:2px 7px;border-radius:5px">GUEST</span>
        </div>`;
    }).join('');
    document.getElementById('pm-content').innerHTML=`
        <div style="font-size:1.1rem;font-weight:800;margin-bottom:12px">üëã Guest ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
        ${html}`;
    document.getElementById('profile-modal').classList.add('active');
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TAB: PLAY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildPlay(){
    const tickerText=(document.getElementById('ticker-text')?.textContent||'').trim()||'‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà RxTU10 Dashboard! üéâ';
    return`
    <div class="news-banner" onclick="openFeed()">
        <div class="ticker-label">üì¢ ‡∏Ç‡πà‡∏≤‡∏ß</div>
        <div class="ticker-scroll"><div class="ticker-inner">${tickerText}</div></div>
    </div>
    <div class="sec-head">üïµÔ∏è ‡∏ó‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</div>
    <div class="card">
        <div id="quiz-start">
            <p id="q-msg" style="color:var(--muted);font-size:0.84rem;text-align:center;margin-bottom:12px">‡∏ó‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á +5ü™ô/‡∏Ç‡πâ‡∏≠ &nbsp;|&nbsp; Hi: ${qHigh}</p>
            <button class="btn-gold full" onclick="startQuiz()">‚ñ∂ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
        </div>
        <div id="quiz-play" style="display:none">
            <div style="font-size:0.84rem;color:var(--muted);margin-bottom:6px">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <b id="q-score" style="color:var(--gold);font-size:1rem">0</b></div>
            <div class="q-nick" id="q-nick">...</div>
            <div class="q-grid" id="q-opts"></div>
        </div>
    </div>

    <div class="sec-head">üíä ‡∏ó‡∏≤‡∏¢‡∏¢‡∏≤ (Drug Class)</div>
    <div class="card">
        <div id="dquiz-start">
            <p id="dq-msg" style="color:var(--muted);font-size:0.84rem;text-align:center;margin-bottom:12px">‡∏ó‡∏≤‡∏¢ Drug Class ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á +5ü™ô/‡∏Ç‡πâ‡∏≠ &nbsp;|&nbsp; Hi: ${dqHigh}</p>
            <button class="btn-gold full" onclick="startDrugQuiz()">‚ñ∂ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
        </div>
        <div id="dquiz-play" style="display:none">
            <div style="font-size:0.84rem;color:var(--muted);margin-bottom:6px">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <b id="dq-score" style="color:var(--gold);font-size:1rem">0</b></div>
            <div style="font-size:1.3rem;font-weight:800;color:#3b82f6;text-align:center;margin-bottom:12px" id="dq-drug">...</div>
            <div class="q-grid" id="dq-opts"></div>
        </div>
    </div>

    <div class="coming-soon">
        <div style="font-size:2.5rem;margin-bottom:8px">üîú</div>
        <div style="font-weight:800;font-size:1rem;margin-bottom:4px">‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏°‡∏≤!</div>
        <div style="font-size:0.8rem;opacity:0.7">‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û ‚Ä¢ Drug Interaction ‚Ä¢ Spelling Sprint</div>
        <div style="font-size:0.72rem;opacity:0.5;margin-top:8px">Coming Soon...</div>
    </div>`;}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TAB: SHOP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildShop(){
    const coins=userData?.coins||0;const canBuy=!!currentUser&&coins>=EGG_COST;const canMega=!!currentUser&&coins>=MEGA_COST;
    return`
        <div class="sec-head">üõí ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</div>
        <div class="card" style="text-align:center">
            <div class="egg-wobble">ü•ö</div>
            <div style="font-size:1.1rem;font-weight:800;margin:7px 0 3px">‡πÑ‡∏Ç‡πà‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤</div>
            <div style="color:var(--muted);font-size:0.8rem;margin-bottom:9px">‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏ü‡∏±‡∏Å‡πÉ‡∏ô Home ‚Äî ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏£‡∏π‡πâ‡∏ï‡∏≠‡∏ô‡∏ü‡∏±‡∏Å‡πÄ‡∏™‡∏£‡πá‡∏à!</div>
            <div class="rates-wrap">
                <span class="rate-chip" style="background:#f1f5f9;color:#64748b">Common 50% ‚Ä¢ 5‡∏ô</span>
                <span class="rate-chip" style="background:#eff6ff;color:#3b82f6">Rare 30% ‚Ä¢ 1‡∏ä‡∏°</span>
                <span class="rate-chip" style="background:#faf5ff;color:#a855f7">Epic 15% ‚Ä¢ 3‡∏ä‡∏°</span>
                <span class="rate-chip" style="background:#fffbeb;color:#f59e0b">??? 5% ‚Ä¢ ??</span>
            </div>
            <button class="btn-gold full" style="margin-top:12px;padding:12px;font-size:0.95rem" onclick="buyEgg()" ${canBuy?'':'disabled'}>
                ü•ö ‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏Ç‡πà ‚Äî ${EGG_COST}ü™ô
            </button>
            ${!currentUser?'<p style="color:var(--muted);font-size:0.76rem;margin-top:6px">Login ‡∏Å‡πà‡∏≠‡∏ô</p>':!canBuy?`<p style="color:#ef4444;font-size:0.76rem;margin-top:6px">‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏°‡πà‡∏û‡∏≠ (‡∏°‡∏µ ${coins} / ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ${EGG_COST})</p>`:''}
        </div>

        <div class="sec-head">üì£ ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©</div>
        <div class="card">
            <div style="display:flex;align-items:center;gap:12px;padding:4px 0">
                <div style="font-size:2.4rem;flex-shrink:0">üì£</div>
                <div style="flex:1">
                    <div style="font-weight:700;font-size:0.95rem">‡πÇ‡∏ó‡∏£‡πÇ‡∏Ç‡πà‡∏á</div>
                    <div style="font-size:0.76rem;color:var(--muted)">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏∂‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏Ç‡πà‡∏≤‡∏ß ‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πà‡∏ß‡∏´‡∏ô‡πâ‡∏≤</div>
                </div>
                <button class="btn-gold sm" onclick="openMega()" ${canMega?'':'disabled'}>${MEGA_COST}ü™ô</button>
            </div>
        </div>

        <div class="sec-head">üêæ ‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ó‡∏µ‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å</div>
        <div class="card">
            ${['common','rare'].map(r=>{const list=PETS.filter(p=>p.rarity===r);const cfg=RARITY[r];return`<div style="margin-bottom:12px"><div style="font-weight:700;color:${cfg.color};font-size:0.78rem;margin-bottom:7px">${cfg.label} ‚Äî ${(list.reduce((a,p)=>a+p.rate,0)*100).toFixed(0)}% ‚Ä¢ ‡∏ü‡∏±‡∏Å ${HATCH_LABELS[r]}</div><div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(84px,1fr));gap:7px">${list.map(p=>`<div style="background:${cfg.bg};border-radius:11px;padding:9px 5px;text-align:center;border:1.5px solid ${cfg.color}33"><div style="font-size:1.6rem">${p.emoji}</div><div style="font-size:0.68rem;font-weight:700;margin-top:3px">${p.name}</div><div style="font-size:0.58rem;color:var(--muted);margin-top:1px">${p.desc}</div></div>`).join('')}</div></div>`;}).join('')}
            <div style="text-align:center;padding:12px;color:var(--muted);font-size:0.78rem">üîÆ ‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô <b>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö</b>...</div>
        </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BOOT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.__tab='home';
loadTicker();
// Hatch timer refresh ‚Äî only when eggs actively hatching, never during game
setInterval(()=>{
    const eggs=(userData?.eggs||[]);
    const hasHatching=eggs.some(e=>e.startedAt&&Date.now()<e.startedAt+e.hatchMins*60000);
    if(!hasHatching) return; // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏Ç‡πà‡∏ü‡∏±‡∏Å ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á re-render
    const tab=window.__tab;
    if(tab==='shop') renderTab('shop');
    if(tab==='home') renderTab('home');
},10000);

</script>

<script>
window.toast=(msg,type='info')=>{const t=document.getElementById('toast');t.textContent=msg;t.className='show '+type;clearTimeout(t._t);t._t=setTimeout(()=>t.classList.remove('show'),3000);};
</script>
</body>
</html>
